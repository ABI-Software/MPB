!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):"object"==typeof exports?exports.Zinc=t(require("three")):e.Zinc=t(e.THREE)}(this,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=new function(){this.Revision=28,this.defaultMaterialColor=8331034,this.defaultOpacity=1,this.Geometry=i(1).Geometry,this.Glyph=i(3).Glyph,this.Glyphset=i(4).Glyphset,this.Renderer=i(6).Renderer,this.Scene=i(7).Scene,this.Viewport=i(8).Viewport,this.CameraControls=i(8).CameraControls,this.SmoothCameraTransition=i(8).SmoothCameraTransition,this.RayCaster=i(8).RayCaster,this.CameraAutoTumble=i(8).CameraAutoTumble,this.loadExternalFile=i(9).loadExternalFile,this.loadExternalFiles=i(9).loadExternalFiles,this.StereoEffect=i(8).StereoEffect}},function(e,t,i){var n=i(2);t.Geometry=function(){this.geometry=void 0,this.mixer=void 0,this.timeEnabled=!1,this.morphColour=!1,this.modelId=-1,this.morph=void 0,this.clipAction=void 0,this.duration=3e3,this.groupName=void 0;var e=0,t=this;this.setVisibility=function(e){t.morph.visible=e},this.setAlpha=function(e){var i=t.morph.material,n=!1;e<1&&(n=!0),i.transparent=n,i.opacity=e},this.getCurrentTime=function(){if(t.clipAction){var i=t.clipAction.time/t.clipAction._clip.duration;return t.duration*i}return e},this.setMorphTime=function(o){if(t.clipAction){var r=o/t.duration,a=t.clipAction._clip.duration;t.clipAction.time=r*a,t.clipAction.time>a&&(t.clipAction.time=a),t.clipAction.time<0&&(t.clipAction.time=0),1==t.timeEnabled&&t.mixer.update(0)}else e=o>t.duration?t.duration:0>o?0:o;1==t.morphColour&&void 0!==t.geometry&&(t.morph.material.vertexColors==n.VertexColors&&i(t.geometry,t.morph,t.clipAction),t.geometry.colorsNeedUpdate=!0)},this.calculateUVs=function(){t.geometry.computeBoundingBox();var e=t.geometry.boundingBox.max,i=t.geometry.boundingBox.min,o=new n.Vector2(0-i.x,0-i.y),r=new n.Vector2(e.x-i.x,e.y-i.y);t.geometry.faceVertexUvs[0]=[];for(var a=0;a<t.geometry.faces.length;a++){var s=t.geometry.vertices[t.geometry.faces[a].a],c=t.geometry.vertices[t.geometry.faces[a].b],l=t.geometry.vertices[t.geometry.faces[a].c];geometry.faceVertexUvs[0].push([new n.Vector2((s.x+o.x)/r.x,(s.y+o.y)/r.y),new n.Vector2((c.x+o.x)/r.x,(c.y+o.y)/r.y),new n.Vector2((l.x+o.x)/r.x,(l.y+o.y)/r.y)])}geometry.uvsNeedUpdate=!0},this.setWireframe=function(e){t.morph.material.wireframe=e},this.setVertexColors=function(e){t.morph.material.vertexColors=e,t.geometry.colorsNeedUpdate=!0},this.setColour=function(e){t.morph.material.color=e,t.geometry.colorsNeedUpdate=!0},this.setMaterial=function(e){t.morph.material=e,t.geometry.colorsNeedUpdate=!0},getColorsRGB=function(e,t){var i=Math.floor(t/3),o=t%3,r=0;0==o?r=e[i].r:1==o?r=e[i].g:2==o&&(r=e[i].b);var a=new n.Color(r);return[a.r,a.g,a.b]};var i=function(i,n,o){if(n&&i.morphColors&&i.morphColors.length){var r=0;r=o?o.time/o._clip.duration*(i.morphColors.length-1):e/t.duration*(i.morphColors.length-1);for(var a=Math.floor(r),s=1-(r-a),c=Math.ceil(r),l=i.morphColors[a],u=i.morphColors[c],h=0;h<i.faces.length;h++){var d=getColorsRGB(l.colors,i.faces[h].a),m=getColorsRGB(u.colors,i.faces[h].a),p=[d[0]*s+m[0]*(1-s),d[1]*s+m[1]*(1-s),d[2]*s+m[2]*(1-s)];i.faces[h].vertexColors[0].setRGB(p[0],p[1],p[2]),d=getColorsRGB(l.colors,i.faces[h].b),m=getColorsRGB(u.colors,i.faces[h].b),p=[d[0]*s+m[0]*(1-s),d[1]*s+m[1]*(1-s),d[2]*s+m[2]*(1-s)],i.faces[h].vertexColors[1].setRGB(p[0],p[1],p[2]),d=getColorsRGB(l.colors,i.faces[h].c),m=getColorsRGB(u.colors,i.faces[h].c),p=[d[0]*s+m[0]*(1-s),d[1]*s+m[1]*(1-s),d[2]*s+m[2]*(1-s)],i.faces[h].vertexColors[2].setRGB(p[0],p[1],p[2])}}};this.getBoundingBox=function(){if(t.morph)return(new n.Box3).setFromObject(t.morph)},this.dispose=function(){t.morph.geometry.dispose(),t.morph.material.dispose(),t.geometry=void 0,t.mixer=void 0,t.morph=void 0,t.clipAction=void 0,t.groupName=void 0,t=void 0},this.render=function(o,r){if(1==r){if(t.clipAction&&1==t.timeEnabled)t.mixer.update(o);else{var a=e+o;a>t.duration&&(a-=t.duration),e=a}if(1==t.morphColour&&void 0!==t.geometry&&t.morph.material.vertexColors==n.VertexColors){var s=void 0;t.clipAction&&1==t.timeEnabled&&(s=t.clipAction),i(t.geometry,t.morph,s),t.geometry.colorsNeedUpdate=!0}}}}},function(t,i){t.exports=e},function(e,t){t.Glyph=function(e,t,i){var n=t.clone();n.vertexColors=THREE.FaceColors;var o=new THREE.Mesh(e,n);this.id=i;var r=this;this.getMesh=function(){return o},this.getBoundingBox=function(){if(o)return(new THREE.Box3).setFromObject(o)},this.setColor=function(e){o.material.color=e,o.geometry.colorsNeedUpdate=!0},this.setTransformation=function(e,t,i,n){o.matrix.elements[0]=t[0],o.matrix.elements[1]=t[1],o.matrix.elements[2]=t[2],o.matrix.elements[3]=0,o.matrix.elements[4]=i[0],o.matrix.elements[5]=i[1],o.matrix.elements[6]=i[2],o.matrix.elements[7]=0,o.matrix.elements[8]=n[0],o.matrix.elements[9]=n[1],o.matrix.elements[10]=n[2],o.matrix.elements[11]=0,o.matrix.elements[12]=e[0],o.matrix.elements[13]=e[1],o.matrix.elements[14]=e[2],o.matrix.elements[15]=1,o.matrixAutoUpdate=!1},this.dispose=function(){r.material.dispose(),r.mesh=void 0}}},function(e,t,i){var n=i(2),o=i(5).JSONLoader;t.Glyphset=function(){var e=[],t=void 0,r=void 0,a=void 0,s=void 0,c=void 0,l=void 0,u=0,h=0,d=[0,0,0],m=[0,0,0],p=[0,0,0],f="NONE";this.duration=3e3;var v=0;this.ready=!1;var g=new n.Group,y=this,x=!1,b=!1;this.getGroup=function(){return g},this.setVisibility=function(e){g.visible=e},this.load=function(e,i,n){t=e.axis1,r=e.axis2,a=e.axis3,s=e.positions,c=e.scale,l=e.colors,x=e.metadata.MorphColours,b=e.metadata.MorphVertices,u=e.metadata.number_of_time_steps,f=e.metadata.repeat_mode,h=e.metadata.number_of_vertices,"AXES_2D"==f||"MIRROR"==f?h*=2:"AXES_3D"==f&&(h*=3),d=e.metadata.base_size,m=e.metadata.offset,p=e.metadata.scale_factors,new o(!0).load(i,j(n))};var O=function(e,t,i,n,o){var r=[];if("NONE"==f||"MIRROR"==f){for(var a=[0,0,0],s=[0,0,0],c=[0,0,0],l=[0,0,0],u=[0,0,0],h=[0,0,0],v=[0,0,0],g=[0,0,0],y=[0,0,0],x=0;x<3;x++){var b=o[x]<0?-1:1;a[x]=b*d[x]+o[x]*p[x]}for(x=0;x<3;x++)s[x]=t[x]*a[0],c[x]=i[x]*a[1],l[x]=n[x]*a[2],u[x]=e[x]+m[0]*s[x]+m[1]*c[x]+m[2]*l[x],"MIRROR"==f&&(h[x]=-s[x],v[x]=-c[x],g[x]=-l[x],y[x]=u[x],o[0]<0&&(u[x]-=s[x],y[x]-=h[x]));0>l[0]*(s[1]*c[2]-s[2]*c[1])+l[1]*(s[2]*c[0]-s[0]*c[2])+l[2]*(s[0]*c[1]-s[1]*c[0])&&(l[0]=-l[0],l[1]=-l[1],l[2]=-l[2]),r.push([u,s,c,l]),"MIRROR"==f&&(0>g[0]*(h[1]*v[2]-h[2]*v[1])+g[1]*(h[2]*v[0]-h[0]*v[2])+g[2]*(h[0]*v[1]-h[1]*v[0])&&(g[0]=-g[0],g[1]=-g[1],g[2]=-g[2]),r.push([y,h,v,g]))}else if("AXES_2D"==f||"AXES_3D"==f){for(a=[0,0,0],u=[0,0,0],x=0;x<3;x++){b=o[x]<0?-1:1;a[x]=b*d[0]+o[x]*p[0]}for(x=0;x<3;x++)u[x]=e[x]+m[0]*a[0]*t[x]+m[1]*a[1]*i[x]+m[2]*a[2]*n[x];for(var O="AXES_2D"==glyph_repeat_mode?2:3,_=0;_<O;_++){var w,C,j=o[_];s=[0,0,0],c=[0,0,0],l=[0,0,0];0==_?(w=t,C=i):1==_?(w=i,C="AXES_2D"==glyph_repeat_mode?t:n):(w=n,C=t);var E=d[0]+j*p[0];s[0]=w[0]*E,s[1]=w[1]*E,s[2]=w[2]*E,l[0]=s[1]*C[2]-C[1]*s[2],l[1]=s[2]*C[0]-C[2]*s[0],l[2]=s[0]*C[1]-s[1]*C[0];var T=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);if(0<T){var R=(d[2]+j*p[2])/T;"AXES_2D"==f&&_>0&&(R*=-1),l[0]*=R,l[1]*=R,l[2]*=R}if(c[0]=l[1]*s[2]-s[1]*l[2],c[1]=l[2]*s[0]-s[2]*l[0],c[2]=l[0]*s[1]-l[1]*s[0],0<(T=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]))){R=(d[1]+j*p[1])/T;c[0]*=R,c[1]*=R,c[2]*=R}r.push([u,s,c,l])}}return r},_=function(t,i,n,o,r){var a=1;"AXES_2D"==f||"MIRROR"==f?a=2:"AXES_3D"==f&&(a=3);for(var s=t.length/3,c=0,l=0;l<s;l++){var u=3*l,h=[t[u],t[u+1],t[u+2]],d=[i[u],i[u+1],i[u+2]],m=[n[u],n[u+1],n[u+2]],p=[o[u],o[u+1],o[u+2]],v=[r[u],r[u+1],r[u+2]],g=O(h,d,m,p,v);if(g.length==a)for(var y=0;y<a;y++){var x=e[c];x&&x.setTransformation(g[y][0],g[y][1],g[y][2],g[y][3]),c++}}},w=function(t){var i=1;"AXES_2D"==f||"MIRROR"==f?i=2:"AXES_3D"==f&&(i=3);for(var o=t.length,r=0,a=0;a<o;a++)for(var s=t[a],c=0;c<i;c++){var l=e[r];if(l){var u=new n.Color(s);l.setColor(u)}r++}},C=function(){var e=[],i=[],o=[],h=[],d=[],m=[],p=v/y.duration*(u-1),f=Math.floor(p),g=1-(p-f),O=Math.ceil(p);if(b)for(var C=s[f.toString()],j=s[O.toString()],E=t[f.toString()],T=t[O.toString()],R=r[f.toString()],S=r[O.toString()],M=a[f.toString()],L=a[O.toString()],P=c[f.toString()],z=c[O.toString()],A=0;A<C.length;A++)e.push(g*C[A]+(1-g)*j[A]),i.push(g*E[A]+(1-g)*T[A]),o.push(g*R[A]+(1-g)*S[A]),h.push(g*M[A]+(1-g)*L[A]),d.push(g*P[A]+(1-g)*z[A]);else e=s[0],i=t[0],o=r[0],h=a[0],d=c[0];if(_(e,i,o,h,d),void 0!=l){if(x){var V=l[f.toString()],G=l[O.toString()];for(A=0;A<V.length;A++){var N=new n.Color(V[A]),D=new n.Color(G[A]),B=new n.Color(N.r*g+D.r*(1-g),N.g*g+D.g*(1-g),N.b*g+D.b*(1-g));m.push(B.getHex())}}else m=l[0];w(m)}e=null,i=null,o=null,h=null,d=null,m=null};this.forEachGlyph=function(t){for(var i=0;i<e.length;i++)t(e[i])};var j=function(n){return function(o,u){var d=void 0;u&&u[0]&&(d=u[0]),function(n,o){for(var u=0;u<h;u++){var d=new(i(3).Glyph)(n,o,u+1);e[u]=d,g.add(d.getMesh())}_(s[0],t[0],r[0],a[0],c[0]),void 0!=l&&w(l[0]),y.ready=!0}(o,d),void 0!=n&&"function"==typeof n&&n(y)}};this.getBoundingBox=function(){for(var t=void 0,i=void 0,n=0;n<e.length;n++)i=e[n].getBoundingBox(),void 0==t?t=i:t.union(i);return t},this.setMorphTime=function(e){v=e>y.duration?y.duration:0>e?0:e,(x||b)&&C()},this.dispose=function(){for(var i=e.length-1;i>=0;i--)e[i].dispose();t=void 0,r=void 0,a=void 0,s=void 0,c=void 0,l=void 0,y.ready=!1,void 0},this.render=function(e,t){if(1==t){var i=v+e;i>y.duration&&(i-=y.duration),v=i,(x||b)&&C()}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"JSONLoader",function(){return f});var n=i(2),o=n.Loader,r=n.LoaderUtils,a=n.AnimationClip,s=n.Vector3,c=n.Vector4,l=n.Color,u=n.Vector2,h=n.Face3,d=n.Geometry,m=n.FileLoader,p=n.DefaultLoadingManager;function f(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:p,this.withCredentials=!1}Object.assign(f.prototype,{load:function(e,t,i,n){var o=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:r.extractUrlBase(e),s=new m(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(i){var n=JSON.parse(i),r=n.metadata;if(void 0!==r){var s=r.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var c=o.parse(n,a);t(c.geometry,c.materials)},i,n)},setTexturePath:function(e){this.texturePath=e},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var i=new d;return i.morphColors=[],function(e,t){function i(e,t){return e&1<<t}var n,o,r,a,c,d,m,p,f,v,g,y,x,b,O,_,w,C,j,E,T,R,S,M,L,P,z,A=e.faces,V=e.vertices,G=e.normals,N=e.colors,D=e.scale,B=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&B++;for(n=0;n<B;n++)t.faceVertexUvs[n]=[]}for(a=0,c=V.length;a<c;)(C=new s).x=V[a++]*D,C.y=V[a++]*D,C.z=V[a++]*D,t.vertices.push(C);for(a=0,c=A.length;a<c;)if(g=i(v=A[a++],0),y=i(v,1),x=i(v,3),b=i(v,4),O=i(v,5),_=i(v,6),w=i(v,7),g){if((E=new h).a=A[a],E.b=A[a+1],E.c=A[a+3],(T=new h).a=A[a+1],T.b=A[a+2],T.c=A[a+3],a+=4,y&&(f=A[a++],E.materialIndex=f,T.materialIndex=f),r=t.faces.length,x)for(n=0;n<B;n++)for(M=e.uvs[n],t.faceVertexUvs[n][r]=[],t.faceVertexUvs[n][r+1]=[],o=0;o<4;o++)P=M[2*(p=A[a++])],z=M[2*p+1],L=new u(P,z),2!==o&&t.faceVertexUvs[n][r].push(L),0!==o&&t.faceVertexUvs[n][r+1].push(L);if(b&&(m=3*A[a++],E.normal.set(G[m++],G[m++],G[m]),T.normal.copy(E.normal)),O)for(n=0;n<4;n++)m=3*A[a++],S=new s(G[m++],G[m++],G[m]),2!==n&&E.vertexNormals.push(S),0!==n&&T.vertexNormals.push(S);if(_&&(R=N[d=A[a++]],E.color.setHex(R),T.color.setHex(R)),w)for(n=0;n<4;n++)R=N[d=A[a++]],2!==n&&E.vertexColors.push(new l(R)),0!==n&&T.vertexColors.push(new l(R));t.faces.push(E),t.faces.push(T)}else{if((j=new h).a=A[a++],j.b=A[a++],j.c=A[a++],y&&(f=A[a++],j.materialIndex=f),r=t.faces.length,x)for(n=0;n<B;n++)for(M=e.uvs[n],t.faceVertexUvs[n][r]=[],o=0;o<3;o++)P=M[2*(p=A[a++])],z=M[2*p+1],L=new u(P,z),t.faceVertexUvs[n][r].push(L);if(b&&(m=3*A[a++],j.normal.set(G[m++],G[m++],G[m])),O)for(n=0;n<3;n++)m=3*A[a++],S=new s(G[m++],G[m++],G[m]),j.vertexNormals.push(S);if(_&&(d=A[a++],j.color.setHex(N[d])),w)for(n=0;n<3;n++)d=A[a++],j.vertexColors.push(new l(N[d]));t.faces.push(j)}}(e,i),function(e,t){var i=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,o=e.skinWeights.length;n<o;n+=i){var r=e.skinWeights[n],a=i>1?e.skinWeights[n+1]:0,s=i>2?e.skinWeights[n+2]:0,l=i>3?e.skinWeights[n+3]:0;t.skinWeights.push(new c(r,a,s,l))}if(e.skinIndices)for(n=0,o=e.skinIndices.length;n<o;n+=i){var u=e.skinIndices[n],h=i>1?e.skinIndices[n+1]:0,d=i>2?e.skinIndices[n+2]:0,m=i>3?e.skinIndices[n+3]:0;t.skinIndices.push(new c(u,h,d,m))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,i),function(e,t){var i,o,r,a,c,l=e.scale;if(void 0!==e.morphTargets)for(var u=0,h=e.morphTargets.length;u<h;u++){t.morphTargets[u]={},t.morphTargets[u].name=e.morphTargets[u].name,t.morphTargets[u].vertices=[];for(var d=t.morphTargets[u].vertices,m=e.morphTargets[u].vertices,p=0,f=m.length;p<f;p+=3){var v=new s;v.x=m[p]*l,v.y=m[p+1]*l,v.z=m[p+2]*l,d.push(v)}}if(void 0!==e.morphColors)for(u=0,h=e.morphColors.length;u<h;u++)for(t.morphColors[u]={},t.morphColors[u].name=e.morphColors[u].name,t.morphColors[u].colors=[],r=t.morphColors[u].colors,i=0,o=(a=e.morphColors[u].colors).length;i<o;i+=3)(c=new n.Color(16755200)).setRGB(a[i],a[i+1],a[i+2]),r.push(c)}(e,i),function(e,t){var i=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var o=0;o<n.length;o++){var r=a.parseAnimation(n[o],t.bones);r&&i.push(r)}if(t.morphTargets){var s=a.CreateClipsFromMorphTargetSequences(t.morphTargets,10);i=i.concat(s)}i.length>0&&(t.animations=i)}(e,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:i}:{geometry:i,materials:o.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}()})},function(e,t,n){var o=n(2);t.Renderer=function(e,t){var r=e,a=void 0,s=void 0,c=new o.Clock;this.playAnimation=!0;var l=500,u={},h=0,d=void 0,m=void 0,p=void 0,f=void 0,v=[],g=[],y=new o.Group,x=this,b=[0,0],O=[0,0];this.onWindowResize=function(){if(s.onWindowResize(),void 0!=a){a.setSize(r.clientWidth,r.clientHeight),b[0]=a.getSize().width,b[1]=a.getSize().height;var e=r.getBoundingClientRect();O[0]=e.left,O[1]=e.top}},this.initialiseVisualisation=function(){var e=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=!0),a=e?new o.WebGLRenderer({antialias:!1}):new o.WebGLRenderer({antialias:!0}),r.appendChild(a.domElement),a.setClearColor(16777215,1);var t=x.createScene("default");x.setCurrentScene(t)},this.getCurrentScene=function(){return s},this.setCurrentScene=function(e){if(e){x.removeActiveScene(e);var t=s;s=e,t&&t.setInteractiveControlEnable(!1),s.setInteractiveControlEnable(!0),s.setAdditionalScenesGroup(y),x.onWindowResize()}},this.getSceneByName=function(e){return v[e]},this.createScene=function(e){if(void 0==v[e]){var t=new(n(7).Scene)(r,a);return v[e]=t,t.sceneName=e,t}};this.resetView=function(){s.resetView()},this.viewAll=function(){if(s){var e=s.getBoundingBox();if(e){for(i=0;i<g.length;i++){var t=g[i].getBoundingBox();t&&e.union(t)}s.viewAllWithBoundingBox(e)}}},this.loadModelsURL=function(e,t,i,n,o,r){s.loadModelsURL(e,t,i,n,o,r)};this.loadViewURL=function(e){s.loadViewURL(e)},this.loadFromViewURL=function(e,t){s.loadFromViewURL(e,t)},this.addZincGeometry=function(e,t,i,n,o,r,a,c){return s.addZincGeometry(e,t,i,n,o,r,a,c)},this.updateDirectionalLight=function(){s.updateDirectionalLight()},this.stopAnimate=function(){cancelAnimationFrame(d),d=void 0},this.animate=function(){d=requestAnimationFrame(x.animate),x.render()};Date.now();this.addPreRenderCallbackFunction=function(e){return u[h+=1]=e,h},this.removePreRenderCallbackFunction=function(e){e in u&&delete u[e]},this.getPlayRate=function(){return l},this.setPlayRate=function(e){l=e},this.getCurrentTime=function(){return s.getCurrentTime()},this.setMorphsTime=function(e){s.setMorphsTime(e)},this.getZincGeometryByID=function(e){return s.getZincGeometryByID(e)},this.addToScene=function(e){s.addObject(e)},this.addToOrthoScene=function(e){void 0==p&&(p=new o.Scene),void 0==m&&((m=new o.OrthographicCamera(-r.clientWidth/2,r.clientWidth/2,r.clientHeight/2,-r.clientHeight/2,1,10)).position.z=10),p.add(e)};this.addLogo=function(){f=new o.Sprite;o.ImageUtils.loadTexture("images/abi_big_logo_transparent_small.png",void 0,function(e){return function(t){t.needsUpdate=!0;var i=new o.SpriteMaterial({map:t}),n=i.map.image.width,a=i.map.image.height;e.material=i,e.scale.set(n,a,1),e.position.set((r.clientWidth-n)/2,(-r.clientHeight+a)/2,1),x.addToOrthoScene(e)}}(f))},this.render=function(){var e=r.getBoundingClientRect();b[0]==r.clientWidth&&b[1]==r.clientHeight&&e.left==O[0]&&e.top==O[1]||x.onWindowResize();var t=c.getDelta();for(s.renderGeometries(l,t,x.playAnimation),i=0;i<g.length;i++){g[i].renderGeometries(l,t,x.playAnimation)}for(key in void 0!=m&&void 0!=p&&(a.clearDepth(),a.render(p,m)),u)u.hasOwnProperty(key)&&u[key].call();s.render(a)},this.getThreeJSRenderer=function(){return a},this.isSceneActive=function(e){if(s===e)return!0;for(i=0;i<g.length;i++){if(g[i]===e)return!0}return!1},this.addActiveScene=function(e){x.isSceneActive(e)||(g.push(e),y.add(e.getThreeJSScene()))},this.removeActiveScene=function(e){for(i=0;i<g.length;i++){if(g[i]===e)return g.splice(i,1),void y.remove(e.getThreeJSScene())}},this.clearAllActiveScene=function(){for(var e=0;e<g.length;e++)y.remove(g[e].getThreeJSScene());g.splice(0,g.length)},this.transitionScene=function(e,t){if(s){var i=s.getZincCameraControls(),n=e.getBoundingBox();if(n){var o=n.min.distanceTo(n.max)/2,r=(n.min.x+n.max.x)/2,a=(n.min.y+n.max.y)/2,c=(n.min.z+n.max.z)/2,l=i.getViewportFromCentreAndRadius(r,a,c,o,40,4*o),u=i.getCurrentViewport();i.cameraTransition(u,l,t),i.enableCameraTransition()}}}}},function(e,t,n){var o=n(2),r=n(5).JSONLoader;t.Scene=function(e,t){var a=e,s=[],c=[],l=new o.Scene;this.directionalLight=void 0,this.ambient=void 0,this.camera=void 0;var u=3e3,h=void 0,d=0,m=1e3;this.sceneName=void 0,this.progressMap=[];var p=!1,f=!1,v=void 0,g=this;this.autoClearFlag=!0,this.getDownloadProgress=function(){var e=0,t=0,i=!1;for(var n in g.progressMap){var o=g.progressMap[n];e+=o[1],t+=o[0],0==o[1]&&(i=!0)}return i&&(e=0),[e,t,p]},this.onProgress=function(e){return function(t){g.progressMap[e]=[t.loaded,t.total]}},this.onError=function(e){p=!0},this.onWindowResize=function(){h.onResize(),g.camera.aspect=a.clientWidth/a.clientHeight,g.camera.updateProjectionMatrix()},this.resetView=function(){g.onWindowResize(),h.resetView()};g.camera=new o.PerspectiveCamera(40,a.clientWidth/a.clientHeight,0,10),g.ambient=new o.AmbientLight(2105376),l.add(g.ambient),g.directionalLight=new o.DirectionalLight(7829367),l.add(g.directionalLight),(h=new(n(8).CameraControls)(g.camera,t.domElement,t,l)).setDirectionalLight(g.directionalLight),h.resetView();var y=function(){for(var e=!0;1==e;){m++,e=!1;for(var t=0;t<s.length;t++)s[t].modelId==m&&(e=!0)}return m};this.loadView=function(e){var t=new(n(8).Viewport);t.nearPlane=e.nearPlane,t.farPlane=e.farPlane,t.eyePosition=e.eyePosition,t.targetPosition=e.targetPosition,t.upVector=e.upVector,h.setDefaultCameraSettings(t),h.resetView()},this.getBoundingBox=function(){for(var e=void 0,t=void 0,i=0;i<s.length;i++)t=s[i].getBoundingBox(),void 0==e?e=t:e.union(t);for(i=0;i<c.length;i++)t=c[i].getBoundingBox(),void 0==e?e=t:e.union(t);return e},this.viewAllWithBoundingBox=function(e){if(e){var t=e.min.distanceTo(e.max)/2,i=(e.min.x+e.max.x)/2,n=(e.min.y+e.max.y)/2,o=(e.min.z+e.max.z)/2,r=h.getViewportFromCentreAndRadius(i,n,o,t,40,4*t);h.setCurrentCameraSettings(r)}},this.viewAll=function(){var e=g.getBoundingBox();g.viewAllWithBoundingBox(e)},this.forEachGeometry=function(e){for(var t=0;t<s.length;t++)e(s[t])},this.forEachGlyphset=function(e){for(var t=0;t<c.length;t++)e(c[t])},this.findGeometriesWithGroupName=function(e){for(var t=[],i=0;i<s.length;i++)s[i].groupName==e&&t.push(s[i]);return t},this.findGlyphsetsWithGroupName=function(e){for(var t=[],i=0;i<c.length;i++)c[i].groupName==e&&t.push(c[i]);return t};var x=function(e,t,i,o){return function(){4==e.readyState&&200==e.status&&function(e,t,i,o){var r=new(n(4).Glyphset);r.duration=3e3,r.load(e,t,o),r.groupName=i;var a=r.getGroup();l.add(a),c.push(r)}(JSON.parse(e.responseText),t,i,o)}};this.loadGlyphsetURL=function(e,t,i,n){var o=new XMLHttpRequest;o.onreadystatechange=x(o,t,i,n),o.open("GET",e,!0),o.send()};var b=function(e,t){e&&("Surfaces"==e.Type?function(e,t,a,s,c,l){d+=1;var u=y(),h=n(0).defaultMaterialColor,m=n(0).defaultOpacity,p=0;void 0!=t&&(p=!!t);var f=0;void 0!=a&&(f=!!a);var v=new r(!0);if(void 0!==c)if("STL"==c)v=new o.STLLoader;else if("OBJ"==c)return void(v=new o.OBJLoader).load(e,_(u,h,m,p,f,s,l),g.onProgress(i),g.onError);v.load(e,w(u,h,m,p,f,s,l),g.onProgress(i),g.onError)}(e.URL,e.MorphVertices,e.MorphColours,e.GroupName,e.FileFormat,t):"Glyph"==e.Type&&g.loadGlyphsetURL(e.URL,e.GlyphGeometriesURL,e.GroupName,t))};this.loadSTL=function(e,t,i){d+=1;var n=y(),r=Zinc.defaultMaterialColor,a=Zinc.defaultOpacity;(new o.STLLoader).load(e,w(n,r,a,!1,!1,t,i))},this.loadOBJ=function(e,t,i){d+=1;var n=y(),r=Zinc.defaultMaterialColor,a=Zinc.defaultOpacity;(new o.OBJLoader).load(e,w(n,r,a,!1,!1,t,i))},this.loadMetadataURL=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText),o=e.length;for(i=0;i<o;i++)b(e[i],t)}},requestURL=e,n.open("GET",e,!0),n.send()},this.loadModelsURL=function(e,t,i,n,o,a){var s=e.length;d+=s;for(var c=0;c<s;c++){var l=y(),u=e[c],h=new r(!0),m=Zinc.defaultMaterialColor,p=Zinc.defaultOpacity;void 0!=t&&void 0!=t[c]&&(m=!!t[c]),void 0!=i&&void 0!=i[c]&&(p=i[c]);var f=0;void 0!=n&&void 0!=n[c]&&(f=!!n[c]);var v=0;void 0!=o&&void 0!=o[c]&&(v=!!o[c]),h.load(u,w(l,m,p,f,v,void 0,a),g.onProgress(c),g.onError)}},this.loadViewURL=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText);g.loadView(e)}},requestURL=e,t.open("GET",requestURL,!0),t.send()},this.loadFromViewURL=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var n=JSON.parse(i.responseText);g.loadView(n);for(var o=[],r=e+"_",a=0;a<n.numberOfResources;a++){var s=r+(a+1)+".json";o.push(s)}g.loadModelsURL(o,n.colour,n.opacity,n.timeEnabled,n.morphColour,t)}},requestURL=e+"_view.json",i.open("GET",requestURL,!0),i.send()};var O=function(e,t,i,r){var a=new(n(1).Geometry);l.add(e);var c=new o.AnimationMixer(e),h=void 0,d=e.geometry;if(d.morphTargets){var m=o.AnimationClip.CreateClipsFromMorphTargetSequences(d.morphTargets,10,!0);if(m&&void 0!=m[0])(h=c.clipAction(m[0]).setDuration(u)).loop=o.loopOnce,h.clampWhenFinished=!0,h.play()}return a.duration=3e3,a.geometry=d,a.timeEnabled=i,a.morphColour=r,a.modelId=t,a.morph=e,a.mixer=c,a.clipAction=h,s.push(a),a},_=function(e,t,i,n,r,a,s){return function(t){d++,t.traverse(function(t){if(t instanceof o.Mesh){var i=O(t,e,n,r);i.morph&&(i.morph.name=a),i.groupName=a,void 0!=s&&"function"==typeof s&&s(i)}})}};this.addZincGeometry=function(e,t,i,n,r,a,s,c,l){void 0==s&&(s=!0),s&&d++,isTransparent=!1,1>n&&(isTransparent=!0);var u=void 0;l?(u=l).morphTargets=r:u=e instanceof o.BufferGeometry&&void 0===e.attributes.color?new o.MeshPhongMaterial({color:i,morphTargets:r,morphNormals:!1,transparent:isTransparent,opacity:n}):new o.MeshPhongMaterial({color:i,morphTargets:r,morphNormals:!1,vertexColors:o.VertexColors,transparent:isTransparent,opacity:n}),e instanceof o.Geometry&&e.computeMorphNormals(),u.side=o.DoubleSide;var h;h=new o.Mesh(e,u);var m=O(h,t,r,a);return void 0!=c&&"function"==typeof c&&c(m),m};var w=function(e,t,i,n,o,r,a){return function(s,c){var l=void 0;c&&c[0]&&(l=c[0]);var u=g.addZincGeometry(s,e,t,i,n,o,!1,void 0,l);u.morph&&(u.morph.name=r),u.groupName=r,void 0!=a&&"function"==typeof a&&a(u)}};this.updateDirectionalLight=function(){h.updateDirectionalLight()},this.addObject=function(e){l.add(e)},this.getCurrentTime=function(){var e=0;if(void 0!=s[0]){s[0].mixer;e=s[0].getCurrentTime()}return e},this.setMorphsTime=function(e){for(var t=0;t<s.length;t++)zincGeometry=s[t],zincGeometry.setMorphTime(e);for(t=0;t<c.length;t++)zincGlyphset=c[t],zincGlyphset.setMorphTime(e)},this.getZincGeometryByID=function(e){for(var t=0;t<s.length;t++)if(s[t].modelId==e)return s[t];return null};this.renderGeometries=function(e,t,i){if(h.update(t),s.length==d&&function(){for(var e=0;e<c.length;e++)if(zincGlyphset=c[e],0==zincGlyphset.ready)return!1;return!0}()){for(var n=0;n<s.length;n++)s[n].render(e*t,i);for(n=0;n<c.length;n++)c[n].render(e*t,i)}},this.getThreeJSScene=function(){return l},this.setAdditionalScenesGroup=function(e){l.add(e)},this.render=function(e){g.autoClearFlag&&e.clear(),f&&v?v.render(l,g.camera):e.render(l,g.camera)},this.setInteractiveControlEnable=function(e){1==e?h.enable():h.disable()},this.getZincCameraControls=function(){return h},this.getThreeJSScene=function(){return l},this.setDuration=function(e){u=e},this.getDuration=function(){return u},this.setStereoEffectEnable=function(e){1==e?(v||(v=new o.StereoEffect(t)),v.setSize(a.clientWidth,a.clientHeight)):t.setSize(a.clientWidth,a.clientHeight),g.camera.updateProjectionMatrix(),f=e},this.isStereoEffectEnable=function(){return f},this.removeZincGeometry=function(e){for(var t=0;t<s.length;t++)if(e===s[t])return l.remove(e.morph),s.splice(t,1),void e.dispose()},this.removeZincGlyphset=function(e){for(var t=0;t<c.length;t++)if(e===c[t])return l.remove(e.getGroup()),c[t].dispose(),void c.splice(t,1)},this.clearAll=function(){for(var e=s.length-1;e>=0;e--)l.remove(s[e].morph),s[e].dispose();s=[];for(e=c.length-1;e>=0;e--)l.remove(c[e].getGroup()),c[e].dispose();c=[]}}},function(e,t,i){var n,o,r,a,s,c,l,u,h=i(2),d=function(){this.nearPlane=.1,this.farPlane=2e3,this.eyePosition=[0,0,0],this.targetPosition=[0,0,0],this.upVector=[0,1,0]},m=function(e,t,i,n){var o=e.eyePosition,r=e.targetPosition,a=t.eyePosition,s=t.targetPosition,c=i,l=this,u=n,h=0,d=!1;c.near=Math.min(e.nearPlane,t.nearPlane),c.far=Math.max(e.farPlane,t.farPlane);this.update=function(e){var t,i,n;!1!==l.enabled&&(!function(e){var t=h+e;t>u&&(t=u),h=t}(e),t=h/u,i=[o[0]*(1-t)+a[0]*t,o[1]*(1-t)+a[1]*t,o[2]*(1-t)+a[2]*t],n=[r[0]*(1-t)+s[0]*t,r[1]*(1-t)+s[1]*t,r[2]*(1-t)+s[2]*t],c.cameraObject.position.set(i[0],i[1],i[2]),c.cameraObject.target.set(n[0],n[1],n[2]),h==u&&(d=!0))},this.isTransitionCompleted=function(){return d}},p=function(e,t,i,n){var o=e,r=n,a=t,s=i,c=new h.Raycaster,l=new h.Vector2;this.enable=function(){enable=!0},this.disable=function(){enable=!1};var u=function(e,t,i){var n=e.domElement.getBoundingClientRect();l.x=(t-n.left)/n.width*2-1,l.y=-(i-n.top)/n.height*2+1;var a=o.getThreeJSScene();return r.render(a,e.cameraObject),c.setFromCamera(l,e.cameraObject),c.intersectObjects(a.children,!0)};this.pick=function(e,t,i){if(r&&o&&e&&a){var n=u(e,t,i);a(n,t,i)}},this.move=function(e,t,i){if(r&&o&&e&&s){var n=u(e,t,i);s(n,t,i)}}},f=function(e,t,i,n){var o=new h.Vector3,r=-t,a=n,s=this,c=e;this.stopOnCameraInput=i,this.requireUpdate=!0;this.update=function(e){!1!==s.enabled&&(s.requireUpdate&&(!function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),i=.25*(4*Math.abs(e[0])+4*Math.abs(e[1])),n=-e[1]/t,r=e[0]/t,s=n*e[0]+r*-e[1];s>i?s=i:s<-i&&(s=-i);var c=Math.acos(s/i)-.5*Math.PI,l=new h.Vector3(a.cameraObject.position.x-a.cameraObject.target.x,a.cameraObject.position.y-a.cameraObject.target.y,a.cameraObject.position.z-a.cameraObject.target.z);l.normalize();var u=new h.Vector3(a.cameraObject.up.x,a.cameraObject.up.y,a.cameraObject.up.z);u.normalize();var d=new h.Vector3;d.crossVectors(u,l),d.normalize();var m=new h.Vector3(n*d.x+r*u.x,n*d.y+r*u.y,n*d.z+r*u.z);o.x=Math.sin(c)*l.x+Math.cos(c)*m.x,o.y=Math.sin(c)*l.y+Math.cos(c)*m.y,o.z=Math.sin(c)*l.z+Math.cos(c)*m.z}(c),s.requireUpdate=!1),a.rotateAboutLookAtpoint(o,r))}};StereoCameraZoomFixed=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new h.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new h.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},Object.assign(StereoCameraZoomFixed.prototype,{update:(l=new h.Matrix4,u=new h.Matrix4,function(e){if(n!==e.focus||o!==e.fov||r!==e.aspect*this.aspect||a!==e.near||s!==e.far||c!==e.zoom){n=e.focus,o=e.fov,r=e.aspect*this.aspect,a=e.near,s=e.far,c=e.zoom;var t,i,d=e.projectionMatrix.clone(),m=.032*a/n,p=a*Math.tan(h.Math.DEG2RAD*o*.5)/e.zoom;u.elements[12]=-.032,l.elements[12]=.032,t=-p*r+m,i=p*r+m,d.elements[0]=2*a/(i-t),d.elements[8]=(i+t)/(i-t),this.cameraL.projectionMatrix.copy(d),t=-p*r-m,i=p*r-m,d.elements[0]=2*a/(i-t),d.elements[8]=(i+t)/(i-t),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(l)})});ModifiedDeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0;var i,n,o,r,a=function(e){t.deviceOrientation=e},s=function(){"undefined"!=typeof window&&(t.screenOrientation=window.orientation||0)},c=(i=new h.Vector3(0,0,1),n=new h.Euler,o=new h.Quaternion,r=new h.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,c){var l=new h.Vector3(0,0,1);l.subVectors(e.target,e.position),n.set(a,t,-s,"YXZ");var u=new h.Quaternion;u.setFromEuler(n),u.multiply(r),u.multiply(o.setFromAxisAngle(i,-c)),l.applyQuaternion(u),l.addVectors(e.position,l),e.lookAt(l)});this.connect=function(){s(),"undefined"!=typeof window&&(window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1)),t.enabled=!0},this.disconnect=function(){"undefined"!=typeof window&&(window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1)),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation.alpha?h.Math.degToRad(t.deviceOrientation.alpha):0,i=t.deviceOrientation.beta?h.Math.degToRad(t.deviceOrientation.beta):0,n=t.deviceOrientation.gamma?h.Math.degToRad(t.deviceOrientation.gamma):0,o=t.screenOrientation?h.Math.degToRad(t.screenOrientation):0;c(t.object,e,i,n,o)}},this.dispose=function(){this.disconnect()},this.connect()},t.Viewport=d,t.CameraControls=function(e,t,i,n){var o=this,r=0,a=1,s=2,c=3,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5,SCROLL:6},u={};u.MAIN=l.ROTATE,u.AUXILIARY=l.PAN,u.SECONDARY=l.ZOOM,this.cameraObject=e,this.domElement=void 0!==t?t:document,this.renderer=i,this.scene=n,this.tumble_rate=1.5,this.pointer_x=0,this.pointer_y=0,this.pointer_x_start=0,this.pointer_y_start=0,this.previous_pointer_x=0,this.previous_pointer_y=0,this.near_plane_fly_debt=0,this.touchZoomDistanceStart=0,this.touchZoomDistanceEnd=0,this.directionalLight=0,this.scrollRate=50;var v=3e3,g=0,y=void 0,x=void 0,b=!1,O=500,_=void 0,w=new d,C=r,j=void 0,E=void 0,T=0;this._state=l.NONE;var R=void 0;this.targetTouchId=-1;var S=void 0;function M(e){void 0===S&&(S=o.domElement.getBoundingClientRect()),0==e.button?o._state=u.MAIN:1==e.button?(e.preventDefault(),o._state=u.AUXILIARY):2==e.button&&(o._state=u.SECONDARY),o.pointer_x=e.clientX-S.left,o.pointer_y=e.clientY-S.top,o.pointer_x_start=o.pointer_x,o.pointer_y_start=o.pointer_y,o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y}function L(e){void 0===S&&(S=o.domElement.getBoundingClientRect()),o.pointer_x=e.clientX-S.left,o.pointer_y=e.clientY-S.top,void 0!==R&&R.move(o,e.clientX,e.clientY,o.renderer)}function P(e){o._state=l.NONE,void 0!==R&&o.pointer_x_start==e.clientX-S.left&&o.pointer_y_start==e.clientY-S.top&&R.pick(o,e.clientX,e.clientY,o.renderer)}function z(e){o._state=l.NONE}function A(e){void 0===S&&(S=o.domElement.getBoundingClientRect());var t=e.touches.length;if(1==t)o._state=l.TOUCH_ROTATE,o.pointer_x=e.touches[0].clientX-S.left,o.pointer_y=e.touches[0].clientY-S.top,o.pointer_x_start=o.pointer_x,o.pointer_y_start=o.pointer_y,o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y;else if(2==t){o._state=l.TOUCH_ZOOM;var i=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;o.touchZoomDistanceEnd=o.touchZoomDistanceStart=Math.sqrt(i*i+n*n)}else 3==t&&(o._state=l.TOUCH_PAN,o.targetTouchId=e.touches[0].identifier,o.pointer_x=e.touches[0].clientX-S.left,o.pointer_y=e.touches[0].clientY-S.top,o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y)}function V(e){e.preventDefault(),e.stopPropagation();var t=e.touches.length;if(1==t)o.pointer_x=e.touches[0].clientX-S.left,o.pointer_y=e.touches[0].clientY-S.top;else if(2==t){if(o._state===l.TOUCH_ZOOM){var i=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;o.touchZoomDistanceEnd=Math.sqrt(i*i+n*n)}}else if(3==t&&o._state===l.TOUCH_PAN)for(var r=0;r<3;r++)e.touches[r].identifier==o.targetTouchId&&(o.pointer_x=e.touches[0].clientX-S.left,o.pointer_y=e.touches[0].clientY-S.top)}function G(e){var t=e.touches.length;o.touchZoomDistanceStart=o.touchZoomDistanceEnd=0,o.targetTouchId=-1,o._state=l.NONE,1==t&&void 0!==R&&o.pointer_x_start==e.touches[0].clientX-S.left&&o.pointer_y_start==e.touches[0].clientY-S.top&&R.pick(o.cameraObject,e.touches[0].clientX,e.touches[0].clientY,o.renderer)}function N(e){void 0===S&&(S=o.domElement.getBoundingClientRect()),o._state=l.SCROLL;var t=0;e.deltaY>0?t=o.scrollRate:e.deltaY<0&&(t=-1*o.scrollRate),T+=t,e.preventDefault(),e.stopImmediatePropagation()}function D(){if(void 0!==o.cameraObject){S.width;var e=S.height,t=o.cameraObject.position.clone();t.sub(o.cameraObject.target);var i=(c=0,o._state===l.ZOOM?c=o.previous_pointer_y-o.pointer_y:o._state===l.SCROLL?c=T:(c=-1*(o.touchZoomDistanceEnd-o.touchZoomDistanceStart),o.touchZoomDistanceStart=o.touchZoomDistanceEnd),c),n=t.length(),r=1.5*i/e;if(n+r*n>.01){t.normalize();var a=o.cameraObject.position.clone();if(a.x=a.x+t.x*r*n,a.y=a.y+t.y*r*n,a.z=a.z+t.z*r*n,o.cameraObject.position.set(a.x,a.y,a.z),o.updateDirectionalLight(),1e-5*o.cameraObject.far<o.cameraObject.near+r*n+o.near_plane_fly_debt)0!=o.near_plane_fly_debt&&(o.near_plane_fly_debt+=r*n,o.near_plane_fly_debt>0?(o.cameraObject.near+=o.near_plane_fly_debt,o.cameraObject.far+=o.near_plane_fly_debt,o.near_plane_fly_debt=0):(o.cameraObject.near+=r*n,o.cameraObject.far+=r*n));else{if(0==o.near_plane_fly_debt){var s=o.cameraObject.near-1e-5*o.cameraObject.far;o.cameraObject.near=1e-5*o.cameraObject.far,o.cameraObject.far-=s,o.near_plane_fly_debt-=1e-5*o.cameraObject.far}o.near_plane_fly_debt+=r*n}}}var c;o._state===l.ZOOM&&(o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y),o._state===l.SCROLL&&(T=0)}void 0===o.cameraObject.target&&(o.cameraObject.target=new h.Vector3(0,0,0)),this.onResize=function(){S&&(S=void 0)},this.setMouseButtonAction=function(e,t){u[e]=l[t]},this.rotateAboutLookAtpoint=function(e,t){e.normalize();var i=o.cameraObject.position.clone();i.sub(o.cameraObject.target);var n=i.clone();i.normalize(),.8<Math.abs(i.x*e.x+i.y*e.y+i.z*e.z)&&(i=o.cameraObject.up.clone());var r=new h.Vector3(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x);r.normalize();var a=new h.Vector3(e.y*r.z-e.z*r.y,e.z*r.x-e.x*r.z,e.x*r.y-e.y*r.x),s=e.x*n.x+e.y*n.y+e.z*n.z,c=r.x*n.x+r.y*n.y+r.z*n.z,l=a.x*n.x+a.y*n.y+a.z*n.z,u=e.x*o.cameraObject.up.x+e.y*o.cameraObject.up.y+e.z*o.cameraObject.up.z,d=r.x*o.cameraObject.up.x+r.y*o.cameraObject.up.y+r.z*o.cameraObject.up.z,m=a.x*o.cameraObject.up.x+a.y*o.cameraObject.up.y+a.z*o.cameraObject.up.z,p=Math.cos(t),f=Math.sin(t),v=new h.Vector3(p*r.x+f*a.x,p*r.y+f*a.y,p*r.z+f*a.z),g=new h.Vector3(p*a.x-f*r.x,p*a.y-f*r.y,p*a.z-f*r.z),y=o.cameraObject.target.clone();y.x=y.x+e.x*s+v.x*c+g.x*l,y.y=y.y+e.y*s+v.y*c+g.y*l,y.z=y.z+e.z*s+v.z*c+g.z*l,o.cameraObject.position.set(y.x,y.y,y.z),o.updateDirectionalLight(),o.cameraObject.up.set(e.x*u+v.x*d+g.x*m,e.y*u+v.y*d+g.y*m,e.z*u+v.z*d+g.z*m)},this.setDirectionalLight=function(e){o.directionalLight=e},this.updateDirectionalLight=function(){0!=o.directionalLight&&o.directionalLight.position.set(o.cameraObject.position.x,o.cameraObject.position.y,o.cameraObject.position.z)},this.enable=function(){enabled=!0,this.domElement.addEventListener&&(this.domElement.addEventListener("mousedown",M,!1),this.domElement.addEventListener("mousemove",L,!1),this.domElement.addEventListener("mouseup",P,!1),this.domElement.addEventListener("mouseleave",z,!1),this.domElement.addEventListener("touchstart",A,!1),this.domElement.addEventListener("touchmove",V,!1),this.domElement.addEventListener("touchend",G,!1),this.domElement.addEventListener("wheel",N,!1),this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1))},this.disable=function(){enabled=!1,this.domElement.removeEventListener&&(this.domElement.removeEventListener("mousedown",M,!1),this.domElement.removeEventListener("mousemove",L,!1),this.domElement.removeEventListener("mouseup",P,!1),this.domElement.removeEventListener("mouseleave",z,!1),this.domElement.removeEventListener("touchstart",A,!1),this.domElement.removeEventListener("touchmove",V,!1),this.domElement.removeEventListener("touchend",G,!1),this.domElement.removeEventListener("wheel",N,!1),this.domElement.removeEventListener("contextmenu",function(e){e.preventDefault()},!1))};this.loadPathURL=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&function(e){y=e.CameraPath,x=e.NumberOfPoints}(JSON.parse(i.responseText))},requestURL=e,i.open("GET",requestURL,!0),i.send()},this.setPathDuration=function(e){v=e},this.setTime=function(e){g=e},this.setPlayRate=function(e){O=e};this.getNumberOfTimeFrame=function(){return x},this.getCurrentTimeFrame=function(){var e=g/v*(x-1),t=Math.floor(e),i=1-(e-t);return[t,Math.ceil(e),i]},this.setCurrentTimeFrame=function(e){(g=v*e/(x-1))<0&&(g=0),g>v&&(g=v)};var B=function(e){if(C===a&&(function(e){var t=g+e;t>v&&(t-=v),g=t}(e),y)){for(var t=o.getCurrentTimeFrame(),i=t[0],n=t[1],r=t[2],s=[y[3*i],y[3*i+1],y[3*i+2]],c=[y[3*n],y[3*n+1],y[3*n+2]],l=[],u=0;u<s.length;u++)l.push(r*s[u]+(1-r)*c[u]);o.cameraObject.position.set(l[0],l[1],l[2]),o.cameraObject.target.set(c[0],c[1],c[2]),b&&(o.directionalLight.position.set(l[0],l[1],l[2]),o.directionalLight.target.position.set(c[0],c[1],c[2]))}};this.update=function(e){var t=e*O,i=enabled;C===a?B(t):C===s&&j?(j.update(t),j.isTransitionCompleted()&&(C=r),i=!1):C===c&&E&&E.update(t),i&&(o._state===l.ROTATE||o._state===l.TOUCH_ROTATE?function(){if(void 0!==o.cameraObject){var e=S.width,t=S.height;if(0<e&&0<t){var i=.25*(e+t);delta_x=o.pointer_x-o.previous_pointer_x,delta_y=o.previous_pointer_y-o.pointer_y;var n=Math.sqrt(delta_x*delta_x+delta_y*delta_y);if(n>0){var r=1*-delta_y/n,a=1*delta_x/n,s=r*(o.pointer_x-.5*(e-1))+a*(.5*(t-1)-o.pointer_y);s>i?s=i:s<-i&&(s=-i);var c=Math.acos(s/i)-.5*Math.PI,l=o.tumble_rate*n/i,u=o.cameraObject.position.clone();u.sub(o.cameraObject.target),u.normalize();var d=o.cameraObject.up.clone();d.normalize();var m=d.clone();m.cross(u),m.normalize();var p=[r*m.x+a*d.x,r*m.y+a*d.y,r*m.z+a*d.z],f=new h.Vector3;f.set(Math.sin(c)*u.x+Math.cos(c)*p[0],Math.sin(c)*u.y+Math.cos(c)*p[1],Math.sin(c)*u.z+Math.cos(c)*p[2]),o.rotateAboutLookAtpoint(f,-l)}}}o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y}():o._state===l.PAN||o._state===l.TOUCH_PAN?function(){if(void 0!==o.cameraObject){S.width;var e=S.height,t=o.cameraObject.position.distanceTo(o.cameraObject.target),i=0;o.cameraObject.far>o.cameraObject.near&&t>=o.cameraObject.near&&t<=o.cameraObject.far&&(i=(t-o.cameraObject.near)/(o.cameraObject.far-o.cameraObject.near));var n=new h.Vector3(o.previous_pointer_x,e-o.previous_pointer_y,0),r=new h.Vector3(o.previous_pointer_x,e-o.previous_pointer_y,1),a=new h.Vector3(o.pointer_x,e-o.pointer_y,0),s=new h.Vector3(o.pointer_x,e-o.pointer_y,1);n.unproject(o.cameraObject),r.unproject(o.cameraObject),a.unproject(o.cameraObject),s.unproject(o.cameraObject);var c=.002*((1-i)*(a.x-n.x)+i*(s.x-r.x)),l=.002*((1-i)*(a.y-n.y)+i*(s.y-r.y)),u=.002*((1-i)*(a.z-n.z)+i*(s.z-r.z));o.cameraObject.position.set(o.cameraObject.position.x-c,o.cameraObject.position.y-l,o.cameraObject.position.z-u),o.updateDirectionalLight(),o.cameraObject.target.set(o.cameraObject.target.x-c,o.cameraObject.target.y-l,o.cameraObject.target.z-u)}o.previous_pointer_x=o.pointer_x,o.previous_pointer_y=o.pointer_y}():o._state!==l.ZOOM&&o._state!==l.TOUCH_ZOOM&&o._state!==l.SCROLL||D(),o._state!==l.NONE&&C===c&&E&&E.stopOnCameraInput,o._state===l.SCROLL&&(o._state=l.NONE)),_?_.update():o.cameraObject.lookAt(o.cameraObject.target)},this.playPath=function(){C=a},this.stopPath=function(){C=r},this.isPlayingPath=function(){return C===a},this.enableDirectionalLightUpdateWithPath=function(e){b=e},this.enableDeviceOrientation=function(){_||(_=new ModifiedDeviceOrientationControls(o.cameraObject))},this.disableDeviceOrientation=function(){_&&(_.dispose(),_=void 0)},this.isDeviceOrientationEnabled=function(){return!!_},this.resetView=function(){o.cameraObject.near=w.nearPlane,o.cameraObject.far=w.farPlane,o.cameraObject.position.set(w.eyePosition[0],w.eyePosition[1],w.eyePosition[2]),o.cameraObject.target.set(w.targetPosition[0],w.targetPosition[1],w.targetPosition[2]),o.cameraObject.up.set(w.upVector[0],w.upVector[1],w.upVector[2]),o.cameraObject.updateProjectionMatrix(),o.updateDirectionalLight()},this.setDefaultCameraSettings=function(e){e.nearPlane&&(w.nearPlane=e.nearPlane),e.farPlane&&(w.farPlane=e.farPlane),e.eyePosition&&(w.eyePosition=e.eyePosition),e.targetPosition&&(w.targetPosition=e.targetPosition),e.upVector&&(w.upVector=e.upVector)},this.setCurrentCameraSettings=function(e){e.nearPlane&&(o.cameraObject.near=e.nearPlane),e.farPlane&&(o.cameraObject.far=e.farPlane),e.eyePosition&&o.cameraObject.position.set(e.eyePosition[0],e.eyePosition[1],e.eyePosition[2]),e.targetPosition&&o.cameraObject.target.set(e.targetPosition[0],e.targetPosition[1],e.targetPosition[2]),e.upVector&&o.cameraObject.up.set(e.upVector[0],e.upVector[1],e.upVector[2]),o.cameraObject.updateProjectionMatrix(),o.updateDirectionalLight()},this.getViewportFromCentreAndRadius=function(e,t,i,n,r,a){var s=o.cameraObject.position.x-o.cameraObject.target.x,c=o.cameraObject.position.y-o.cameraObject.target.y,l=o.cameraObject.position.z-o.cameraObject.target.z,u=1/Math.sqrt(s*s+c*c+l*l);s*=u,c*=u,l*=u;var h=[e,t,i],m=n/Math.tan(r*Math.PI/360),p=[e+s*m,t+c*m,i+l*m],f=m+a,v=0;v=a>.95*m?(1-.95)*m:m-a;var g=new d;return g.nearPlane=v,g.farPlane=f,g.eyePosition=p,g.targetPosition=h,g.upVector=[o.cameraObject.up.x,o.cameraObject.up.y,o.cameraObject.up.z],g},this.getDefaultViewport=function(){return w},this.getCurrentViewport=function(){var e=new d;return e.nearPlane=o.cameraObject.near,e.farPlane=o.cameraObject.far,e.eyePosition[0]=o.cameraObject.position.x,e.eyePosition[1]=o.cameraObject.position.y,e.eyePosition[2]=o.cameraObject.position.z,e.targetPosition[0]=o.cameraObject.target.x,e.targetPosition[1]=o.cameraObject.target.y,e.targetPosition[2]=o.cameraObject.target.z,e.upVector[0]=o.cameraObject.up.x,e.upVector[1]=o.cameraObject.up.y,e.upVector[2]=o.cameraObject.up.z,e},this.getDefaultEyePosition=function(){return eyePosition},this.getDefaultTargetPosition=function(){return targetPosition},this.cameraTransition=function(e,t,i){j=new m(e,t,o,i)},this.enableCameraTransition=function(){C=s},this.pauseCameraTransition=function(){C=r},this.stopCameraTransition=function(){C=r,j=void 0},this.isTransitioningCamera=function(){return C===s},this.autoTumble=function(e,t,i){E=new f(e,t,i,o)},this.enableAutoTumble=function(){C=c},this.stopAutoTumble=function(){C=r,E=void 0},this.enableRaycaster=function(e,t,i){void 0==R&&(R=new p(e,t,i,o.renderer))},this.disableRaycaster=function(){R.disable(),R=void 0},this.updateAutoTumble=function(){E&&(E.requireUpdate=!0)},this.isAutoTumble=function(){return C===c},this.enable()},t.SmoothCameraTransition=m,t.RayCaster=p,t.CameraAutoTumble=f,t.StereoEffect=function(e){var t=new StereoCameraZoom;t.aspect=.5,this.setSize=function(t,i){e.setSize(t,i)},this.render=function(i,n){i.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),t.update(n);var o=e.getSize();e.setScissorTest(!0),e.clear(),e.setScissor(0,0,o.width/2,o.height),e.setViewport(0,0,o.width/2,o.height),e.render(i,t.cameraL),e.setScissor(o.width/2,0,o.width/2,o.height),e.setViewport(o.width/2,0,o.width/2,o.height),e.render(i,t.cameraR),e.setScissorTest(!1)}}},function(e,t){function i(e,t,i,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?i(o.responseText,t):n(e))},o.send(null)}t.loadExternalFile=i,t.loadExternalFiles=function(e,t,n){var o=e.length,r=0,a=[];function s(e,i){a[i]=e,++r==o&&t(a)}for(var c=0;c<o;c++)i(e[c],c,s,n)}}])});