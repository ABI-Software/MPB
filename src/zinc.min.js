!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):"object"==typeof exports?exports.Zinc=t(require("three")):e.Zinc=t(e.THREE)}(this,function(e){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=new function(){this.Revision=28,this.defaultMaterialColor=8331034,this.defaultOpacity=1,this.Geometry=i(1).Geometry,this.Glyph=i(3).Glyph,this.Glyphset=i(4).Glyphset,this.Renderer=i(6).Renderer,this.Scene=i(7).Scene,this.Viewport=i(10).Viewport,this.CameraControls=i(10).CameraControls,this.SmoothCameraTransition=i(10).SmoothCameraTransition,this.RayCaster=i(10).RayCaster,this.CameraAutoTumble=i(10).CameraAutoTumble,this.loadExternalFile=i(11).loadExternalFile,this.loadExternalFiles=i(11).loadExternalFiles,this.StereoEffect=i(10).StereoEffect}},function(e,t,i){var r=i(2);t.Geometry=function(){this.geometry=void 0,this.mixer=void 0,this.timeEnabled=!1,this.morphColour=!1,this.modelId=-1,this.morph=void 0,this.clipAction=void 0,this.duration=3e3,this.groupName=void 0;var e=0,t=this;this.setVisibility=function(e){t.morph.visible=e},this.setAlpha=function(e){var i=t.morph.material,r=!1;e<1&&(r=!0),i.transparent=r,i.opacity=e},this.getCurrentTime=function(){if(t.clipAction){var i=t.clipAction.time/t.clipAction._clip.duration;return t.duration*i}return e},this.setMorphTime=function(n){if(t.clipAction){var o=n/t.duration,a=t.clipAction._clip.duration;t.clipAction.time=o*a,t.clipAction.time>a&&(t.clipAction.time=a),t.clipAction.time<0&&(t.clipAction.time=0),1==t.timeEnabled&&t.mixer.update(0)}else e=n>t.duration?t.duration:0>n?0:n;1==t.morphColour&&void 0!==t.geometry&&(t.morph.material.vertexColors==r.VertexColors&&i(t.geometry,t.morph,t.clipAction),t.geometry.colorsNeedUpdate=!0)},this.calculateUVs=function(){t.geometry.computeBoundingBox();var e=t.geometry.boundingBox.max,i=t.geometry.boundingBox.min,n=new r.Vector2(0-i.x,0-i.y),o=new r.Vector2(e.x-i.x,e.y-i.y);t.geometry.faceVertexUvs[0]=[];for(var a=0;a<t.geometry.faces.length;a++){var s=t.geometry.vertices[t.geometry.faces[a].a],c=t.geometry.vertices[t.geometry.faces[a].b],l=t.geometry.vertices[t.geometry.faces[a].c];geometry.faceVertexUvs[0].push([new r.Vector2((s.x+n.x)/o.x,(s.y+n.y)/o.y),new r.Vector2((c.x+n.x)/o.x,(c.y+n.y)/o.y),new r.Vector2((l.x+n.x)/o.x,(l.y+n.y)/o.y)])}geometry.uvsNeedUpdate=!0},this.setWireframe=function(e){t.morph.material.wireframe=e},this.setVertexColors=function(e){t.morph.material.vertexColors=e,t.geometry.colorsNeedUpdate=!0},this.setColour=function(e){t.morph.material.color=e,t.geometry.colorsNeedUpdate=!0},this.setMaterial=function(e){t.morph.material=e,t.geometry.colorsNeedUpdate=!0},getColorsRGB=function(e,t){var i=Math.floor(t/3),n=t%3,o=0;0==n?o=e[i].r:1==n?o=e[i].g:2==n&&(o=e[i].b);var a=new r.Color(o);return[a.r,a.g,a.b]};var i=function(i,r,n){if(r&&i.morphColors&&i.morphColors.length){var o=0;o=n?n.time/n._clip.duration*(i.morphColors.length-1):e/t.duration*(i.morphColors.length-1);for(var a=Math.floor(o),s=1-(o-a),c=Math.ceil(o),l=i.morphColors[a],u=i.morphColors[c],h=0;h<i.faces.length;h++){var d=getColorsRGB(l.colors,i.faces[h].a),m=getColorsRGB(u.colors,i.faces[h].a),p=[d[0]*s+m[0]*(1-s),d[1]*s+m[1]*(1-s),d[2]*s+m[2]*(1-s)];i.faces[h].vertexColors[0].setRGB(p[0],p[1],p[2]),d=getColorsRGB(l.colors,i.faces[h].b),m=getColorsRGB(u.colors,i.faces[h].b),p=[d[0]*s+m[0]*(1-s),d[1]*s+m[1]*(1-s),d[2]*s+m[2]*(1-s)],i.faces[h].vertexColors[1].setRGB(p[0],p[1],p[2]),d=getColorsRGB(l.colors,i.faces[h].c),m=getColorsRGB(u.colors,i.faces[h].c),p=[d[0]*s+m[0]*(1-s),d[1]*s+m[1]*(1-s),d[2]*s+m[2]*(1-s)],i.faces[h].vertexColors[2].setRGB(p[0],p[1],p[2])}}};this.getBoundingBox=function(){if(t.morph)return(new r.Box3).setFromObject(t.morph)},this.dispose=function(){t.morph.geometry.dispose(),t.morph.material.dispose(),t.geometry=void 0,t.mixer=void 0,t.morph=void 0,t.clipAction=void 0,t.groupName=void 0,t=void 0},this.render=function(n,o){if(1==o){if(t.clipAction&&1==t.timeEnabled)t.mixer.update(n);else{var a=e+n;a>t.duration&&(a-=t.duration),e=a}if(1==t.morphColour&&void 0!==t.geometry&&t.morph.material.vertexColors==r.VertexColors){var s=void 0;t.clipAction&&1==t.timeEnabled&&(s=t.clipAction),i(t.geometry,t.morph,s),t.geometry.colorsNeedUpdate=!0}}}}},function(t,i){t.exports=e},function(e,t){t.Glyph=function(e,t,i){var r=t.clone();r.vertexColors=THREE.FaceColors;var n=new THREE.Mesh(e,r);this.id=i;var o=this;this.getMesh=function(){return n},this.getBoundingBox=function(){if(n)return(new THREE.Box3).setFromObject(n)},this.setColor=function(e){n.material.color=e,n.geometry.colorsNeedUpdate=!0},this.setTransformation=function(e,t,i,r){n.matrix.elements[0]=t[0],n.matrix.elements[1]=t[1],n.matrix.elements[2]=t[2],n.matrix.elements[3]=0,n.matrix.elements[4]=i[0],n.matrix.elements[5]=i[1],n.matrix.elements[6]=i[2],n.matrix.elements[7]=0,n.matrix.elements[8]=r[0],n.matrix.elements[9]=r[1],n.matrix.elements[10]=r[2],n.matrix.elements[11]=0,n.matrix.elements[12]=e[0],n.matrix.elements[13]=e[1],n.matrix.elements[14]=e[2],n.matrix.elements[15]=1,n.matrixAutoUpdate=!1},this.dispose=function(){o.material.dispose(),o.mesh=void 0}}},function(e,t,i){var r=i(2),n=i(5).JSONLoader;t.Glyphset=function(){var e=[],t=void 0,o=void 0,a=void 0,s=void 0,c=void 0,l=void 0,u=0,h=0,d=[0,0,0],m=[0,0,0],p=[0,0,0],f="NONE";this.duration=3e3;var v=0;this.ready=!1;var g=new r.Group,y=this,b=!1,x=!1;this.getGroup=function(){return g},this.setVisibility=function(e){g.visible=e},this.load=function(e,i,r){t=e.axis1,o=e.axis2,a=e.axis3,s=e.positions,c=e.scale,l=e.colors,b=e.metadata.MorphColours,x=e.metadata.MorphVertices,u=e.metadata.number_of_time_steps,f=e.metadata.repeat_mode,h=e.metadata.number_of_vertices,"AXES_2D"==f||"MIRROR"==f?h*=2:"AXES_3D"==f&&(h*=3),d=e.metadata.base_size,m=e.metadata.offset,p=e.metadata.scale_factors,new n(!0).load(i,j(r))};var O=function(e,t,i,r,n){var o=[];if("NONE"==f||"MIRROR"==f){for(var a=[0,0,0],s=[0,0,0],c=[0,0,0],l=[0,0,0],u=[0,0,0],h=[0,0,0],v=[0,0,0],g=[0,0,0],y=[0,0,0],b=0;b<3;b++){var x=n[b]<0?-1:1;a[b]=x*d[b]+n[b]*p[b]}for(b=0;b<3;b++)s[b]=t[b]*a[0],c[b]=i[b]*a[1],l[b]=r[b]*a[2],u[b]=e[b]+m[0]*s[b]+m[1]*c[b]+m[2]*l[b],"MIRROR"==f&&(h[b]=-s[b],v[b]=-c[b],g[b]=-l[b],y[b]=u[b],n[0]<0&&(u[b]-=s[b],y[b]-=h[b]));0>l[0]*(s[1]*c[2]-s[2]*c[1])+l[1]*(s[2]*c[0]-s[0]*c[2])+l[2]*(s[0]*c[1]-s[1]*c[0])&&(l[0]=-l[0],l[1]=-l[1],l[2]=-l[2]),o.push([u,s,c,l]),"MIRROR"==f&&(0>g[0]*(h[1]*v[2]-h[2]*v[1])+g[1]*(h[2]*v[0]-h[0]*v[2])+g[2]*(h[0]*v[1]-h[1]*v[0])&&(g[0]=-g[0],g[1]=-g[1],g[2]=-g[2]),o.push([y,h,v,g]))}else if("AXES_2D"==f||"AXES_3D"==f){for(a=[0,0,0],u=[0,0,0],b=0;b<3;b++){x=n[b]<0?-1:1;a[b]=x*d[0]+n[b]*p[0]}for(b=0;b<3;b++)u[b]=e[b]+m[0]*a[0]*t[b]+m[1]*a[1]*i[b]+m[2]*a[2]*r[b];for(var O="AXES_2D"==glyph_repeat_mode?2:3,w=0;w<O;w++){var _,C,j=n[w];s=[0,0,0],c=[0,0,0],l=[0,0,0];0==w?(_=t,C=i):1==w?(_=i,C="AXES_2D"==glyph_repeat_mode?t:r):(_=r,C=t);var E=d[0]+j*p[0];s[0]=_[0]*E,s[1]=_[1]*E,s[2]=_[2]*E,l[0]=s[1]*C[2]-C[1]*s[2],l[1]=s[2]*C[0]-C[2]*s[0],l[2]=s[0]*C[1]-s[1]*C[0];var L=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);if(0<L){var M=(d[2]+j*p[2])/L;"AXES_2D"==f&&w>0&&(M*=-1),l[0]*=M,l[1]*=M,l[2]*=M}if(c[0]=l[1]*s[2]-s[1]*l[2],c[1]=l[2]*s[0]-s[2]*l[0],c[2]=l[0]*s[1]-l[1]*s[0],0<(L=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]))){M=(d[1]+j*p[1])/L;c[0]*=M,c[1]*=M,c[2]*=M}o.push([u,s,c,l])}}return o},w=function(t,i,r,n,o){var a=1;"AXES_2D"==f||"MIRROR"==f?a=2:"AXES_3D"==f&&(a=3);for(var s=t.length/3,c=0,l=0;l<s;l++){var u=3*l,h=[t[u],t[u+1],t[u+2]],d=[i[u],i[u+1],i[u+2]],m=[r[u],r[u+1],r[u+2]],p=[n[u],n[u+1],n[u+2]],v=[o[u],o[u+1],o[u+2]],g=O(h,d,m,p,v);if(g.length==a)for(var y=0;y<a;y++){var b=e[c];b&&b.setTransformation(g[y][0],g[y][1],g[y][2],g[y][3]),c++}}},_=function(t){var i=1;"AXES_2D"==f||"MIRROR"==f?i=2:"AXES_3D"==f&&(i=3);for(var n=t.length,o=0,a=0;a<n;a++)for(var s=t[a],c=0;c<i;c++){var l=e[o];if(l){var u=new r.Color(s);l.setColor(u)}o++}},C=function(){var e=[],i=[],n=[],h=[],d=[],m=[],p=v/y.duration*(u-1),f=Math.floor(p),g=1-(p-f),O=Math.ceil(p);if(x)for(var C=s[f.toString()],j=s[O.toString()],E=t[f.toString()],L=t[O.toString()],M=o[f.toString()],S=o[O.toString()],T=a[f.toString()],R=a[O.toString()],P=c[f.toString()],A=c[O.toString()],V=0;V<C.length;V++)e.push(g*C[V]+(1-g)*j[V]),i.push(g*E[V]+(1-g)*L[V]),n.push(g*M[V]+(1-g)*S[V]),h.push(g*T[V]+(1-g)*R[V]),d.push(g*P[V]+(1-g)*A[V]);else e=s[0],i=t[0],n=o[0],h=a[0],d=c[0];if(w(e,i,n,h,d),void 0!=l){if(b){var z=l[f.toString()],U=l[O.toString()];for(V=0;V<z.length;V++){var B=new r.Color(z[V]),G=new r.Color(U[V]),N=new r.Color(B.r*g+G.r*(1-g),B.g*g+G.g*(1-g),B.b*g+G.b*(1-g));m.push(N.getHex())}}else m=l[0];_(m)}e=null,i=null,n=null,h=null,d=null,m=null};this.forEachGlyph=function(t){for(var i=0;i<e.length;i++)t(e[i])};var j=function(r){return function(n,u){var d=void 0;u&&u[0]&&(d=u[0]),function(r,n){for(var u=0;u<h;u++){var d=new(i(3).Glyph)(r,n,u+1);e[u]=d,g.add(d.getMesh())}w(s[0],t[0],o[0],a[0],c[0]),void 0!=l&&_(l[0]),y.ready=!0}(n,d),void 0!=r&&"function"==typeof r&&r(y)}};this.getBoundingBox=function(){for(var t=void 0,i=void 0,r=0;r<e.length;r++)i=e[r].getBoundingBox(),void 0==t?t=i:t.union(i);return t},this.setMorphTime=function(e){v=e>y.duration?y.duration:0>e?0:e,(b||x)&&C()},this.dispose=function(){for(var i=e.length-1;i>=0;i--)e[i].dispose();t=void 0,o=void 0,a=void 0,s=void 0,c=void 0,l=void 0,y.ready=!1,void 0},this.render=function(e,t){if(1==t){var i=v+e;i>y.duration&&(i-=y.duration),v=i,(b||x)&&C()}}}},function(e,t,i){"use strict";i.r(t),i.d(t,"JSONLoader",function(){return f});var r=i(2),n=r.Loader,o=r.LoaderUtils,a=r.AnimationClip,s=r.Vector3,c=r.Vector4,l=r.Color,u=r.Vector2,h=r.Face3,d=r.Geometry,m=r.FileLoader,p=r.DefaultLoadingManager;function f(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:p,this.withCredentials=!1}Object.assign(f.prototype,{load:function(e,t,i,r){var n=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:o.extractUrlBase(e),s=new m(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,function(i){var r=JSON.parse(i),o=r.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var c=n.parse(r,a);t(c.geometry,c.materials)},i,r)},setTexturePath:function(e){this.texturePath=e},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var i=new d;return i.morphColors=[],function(e,t){function i(e,t){return e&1<<t}var r,n,o,a,c,d,m,p,f,v,g,y,b,x,O,w,_,C,j,E,L,M,S,T,R,P,A,V=e.faces,z=e.vertices,U=e.normals,B=e.colors,G=e.scale,N=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&N++;for(r=0;r<N;r++)t.faceVertexUvs[r]=[]}for(a=0,c=z.length;a<c;)(C=new s).x=z[a++]*G,C.y=z[a++]*G,C.z=z[a++]*G,t.vertices.push(C);for(a=0,c=V.length;a<c;)if(g=i(v=V[a++],0),y=i(v,1),b=i(v,3),x=i(v,4),O=i(v,5),w=i(v,6),_=i(v,7),g){if((E=new h).a=V[a],E.b=V[a+1],E.c=V[a+3],(L=new h).a=V[a+1],L.b=V[a+2],L.c=V[a+3],a+=4,y&&(f=V[a++],E.materialIndex=f,L.materialIndex=f),o=t.faces.length,b)for(r=0;r<N;r++)for(T=e.uvs[r],t.faceVertexUvs[r][o]=[],t.faceVertexUvs[r][o+1]=[],n=0;n<4;n++)P=T[2*(p=V[a++])],A=T[2*p+1],R=new u(P,A),2!==n&&t.faceVertexUvs[r][o].push(R),0!==n&&t.faceVertexUvs[r][o+1].push(R);if(x&&(m=3*V[a++],E.normal.set(U[m++],U[m++],U[m]),L.normal.copy(E.normal)),O)for(r=0;r<4;r++)m=3*V[a++],S=new s(U[m++],U[m++],U[m]),2!==r&&E.vertexNormals.push(S),0!==r&&L.vertexNormals.push(S);if(w&&(M=B[d=V[a++]],E.color.setHex(M),L.color.setHex(M)),_)for(r=0;r<4;r++)M=B[d=V[a++]],2!==r&&E.vertexColors.push(new l(M)),0!==r&&L.vertexColors.push(new l(M));t.faces.push(E),t.faces.push(L)}else{if((j=new h).a=V[a++],j.b=V[a++],j.c=V[a++],y&&(f=V[a++],j.materialIndex=f),o=t.faces.length,b)for(r=0;r<N;r++)for(T=e.uvs[r],t.faceVertexUvs[r][o]=[],n=0;n<3;n++)P=T[2*(p=V[a++])],A=T[2*p+1],R=new u(P,A),t.faceVertexUvs[r][o].push(R);if(x&&(m=3*V[a++],j.normal.set(U[m++],U[m++],U[m])),O)for(r=0;r<3;r++)m=3*V[a++],S=new s(U[m++],U[m++],U[m]),j.vertexNormals.push(S);if(w&&(d=V[a++],j.color.setHex(B[d])),_)for(r=0;r<3;r++)d=V[a++],j.vertexColors.push(new l(B[d]));t.faces.push(j)}}(e,i),function(e,t){var i=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;r<n;r+=i){var o=e.skinWeights[r],a=i>1?e.skinWeights[r+1]:0,s=i>2?e.skinWeights[r+2]:0,l=i>3?e.skinWeights[r+3]:0;t.skinWeights.push(new c(o,a,s,l))}if(e.skinIndices)for(r=0,n=e.skinIndices.length;r<n;r+=i){var u=e.skinIndices[r],h=i>1?e.skinIndices[r+1]:0,d=i>2?e.skinIndices[r+2]:0,m=i>3?e.skinIndices[r+3]:0;t.skinIndices.push(new c(u,h,d,m))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,i),function(e,t){var i,n,o,a,c,l=e.scale;if(void 0!==e.morphTargets)for(var u=0,h=e.morphTargets.length;u<h;u++){t.morphTargets[u]={},t.morphTargets[u].name=e.morphTargets[u].name,t.morphTargets[u].vertices=[];for(var d=t.morphTargets[u].vertices,m=e.morphTargets[u].vertices,p=0,f=m.length;p<f;p+=3){var v=new s;v.x=m[p]*l,v.y=m[p+1]*l,v.z=m[p+2]*l,d.push(v)}}if(void 0!==e.morphColors)for(u=0,h=e.morphColors.length;u<h;u++)for(t.morphColors[u]={},t.morphColors[u].name=e.morphColors[u].name,t.morphColors[u].colors=[],o=t.morphColors[u].colors,i=0,n=(a=e.morphColors[u].colors).length;i<n;i+=3)(c=new r.Color(16755200)).setRGB(a[i],a[i+1],a[i+2]),o.push(c)}(e,i),function(e,t){var i=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var n=0;n<r.length;n++){var o=a.parseAnimation(r[n],t.bones);o&&i.push(o)}if(t.morphTargets){var s=a.CreateClipsFromMorphTargetSequences(t.morphTargets,10);i=i.concat(s)}i.length>0&&(t.animations=i)}(e,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:i}:{geometry:i,materials:n.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}()})},function(e,t,r){var n=r(2);t.Renderer=function(e,t){var o=e,a=void 0,s=void 0,c=new n.Clock;this.playAnimation=!0;var l=500,u={},h=0,d=void 0,m=void 0,p=void 0,f=void 0,v=[],g=[],y=new n.Group,b=this,x=[0,0],O=[0,0];this.onWindowResize=function(){if(s.onWindowResize(),void 0!=a){a.setSize(o.clientWidth,o.clientHeight),x[0]=a.getSize().width,x[1]=a.getSize().height;var e=o.getBoundingClientRect();O[0]=e.left,O[1]=e.top}},this.initialiseVisualisation=function(){var e=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=!0),a=e?new n.WebGLRenderer({antialias:!1}):new n.WebGLRenderer({antialias:!0}),o.appendChild(a.domElement),a.setClearColor(16777215,1);var t=b.createScene("default");b.setCurrentScene(t)},this.getCurrentScene=function(){return s},this.setCurrentScene=function(e){if(e){b.removeActiveScene(e);var t=s;s=e,t&&t.setInteractiveControlEnable(!1),s.setInteractiveControlEnable(!0),s.setAdditionalScenesGroup(y),b.onWindowResize()}},this.getSceneByName=function(e){return v[e]},this.createScene=function(e){if(void 0==v[e]){var t=new(r(7).Scene)(o,a);return v[e]=t,t.sceneName=e,t}};this.resetView=function(){s.resetView()},this.viewAll=function(){if(s){var e=s.getBoundingBox();if(e){for(i=0;i<g.length;i++){var t=g[i].getBoundingBox();t&&e.union(t)}s.viewAllWithBoundingBox(e)}}},this.loadModelsURL=function(e,t,i,r,n,o){s.loadModelsURL(e,t,i,r,n,o)};this.loadViewURL=function(e){s.loadViewURL(e)},this.loadFromViewURL=function(e,t){s.loadFromViewURL(e,t)},this.addZincGeometry=function(e,t,i,r,n,o,a,c){return s.addZincGeometry(e,t,i,r,n,o,a,c)},this.updateDirectionalLight=function(){s.updateDirectionalLight()},this.stopAnimate=function(){cancelAnimationFrame(d),d=void 0},this.animate=function(){d=requestAnimationFrame(b.animate),b.render()};Date.now();this.addPreRenderCallbackFunction=function(e){return u[h+=1]=e,h},this.removePreRenderCallbackFunction=function(e){e in u&&delete u[e]},this.getPlayRate=function(){return l},this.setPlayRate=function(e){l=e},this.getCurrentTime=function(){return s.getCurrentTime()},this.setMorphsTime=function(e){s.setMorphsTime(e)},this.getZincGeometryByID=function(e){return s.getZincGeometryByID(e)},this.addToScene=function(e){s.addObject(e)},this.addToOrthoScene=function(e){void 0==p&&(p=new n.Scene),void 0==m&&((m=new n.OrthographicCamera(-o.clientWidth/2,o.clientWidth/2,o.clientHeight/2,-o.clientHeight/2,1,10)).position.z=10),p.add(e)};this.addLogo=function(){f=new n.Sprite;n.ImageUtils.loadTexture("images/abi_big_logo_transparent_small.png",void 0,function(e){return function(t){t.needsUpdate=!0;var i=new n.SpriteMaterial({map:t}),r=i.map.image.width,a=i.map.image.height;e.material=i,e.scale.set(r,a,1),e.position.set((o.clientWidth-r)/2,(-o.clientHeight+a)/2,1),b.addToOrthoScene(e)}}(f))},this.render=function(){var e=o.getBoundingClientRect();x[0]==o.clientWidth&&x[1]==o.clientHeight&&e.left==O[0]&&e.top==O[1]||b.onWindowResize();var t=c.getDelta();for(s.renderGeometries(l,t,b.playAnimation),i=0;i<g.length;i++){g[i].renderGeometries(l,t,b.playAnimation)}for(key in void 0!=m&&void 0!=p&&(a.clearDepth(),a.render(p,m)),u)u.hasOwnProperty(key)&&u[key].call();s.render(a)},this.getThreeJSRenderer=function(){return a},this.isSceneActive=function(e){if(s===e)return!0;for(i=0;i<g.length;i++){if(g[i]===e)return!0}return!1},this.addActiveScene=function(e){b.isSceneActive(e)||(g.push(e),y.add(e.getThreeJSScene()))},this.removeActiveScene=function(e){for(i=0;i<g.length;i++){if(g[i]===e)return g.splice(i,1),void y.remove(e.getThreeJSScene())}},this.clearAllActiveScene=function(){for(var e=0;e<g.length;e++)y.remove(g[e].getThreeJSScene());g.splice(0,g.length)},this.transitionScene=function(e,t){if(s){var i=s.getZincCameraControls(),r=e.getBoundingBox();if(r){var n=r.min.distanceTo(r.max)/2,o=(r.min.x+r.max.x)/2,a=(r.min.y+r.max.y)/2,c=(r.min.z+r.max.z)/2,l=i.getViewportFromCentreAndRadius(o,a,c,n,40,4*n),u=i.getCurrentViewport();i.cameraTransition(u,l,t),i.enableCameraTransition()}}}}},function(e,t,r){var n=r(2),o=r(5).JSONLoader,a=r(8).STLLoader,s=r(9).OBJLoader;t.Scene=function(e,t){var c=e,l=[],u=[],h=new n.Scene;this.directionalLight=void 0,this.ambient=void 0,this.camera=void 0;var d=3e3,m=void 0,p=0,f=1e3;this.sceneName=void 0,this.progressMap=[];var v=!1,g=!1,y=void 0,b=this;this.autoClearFlag=!0,this.getDownloadProgress=function(){var e=0,t=0,i=!1;for(var r in b.progressMap){var n=b.progressMap[r];e+=n[1],t+=n[0],0==n[1]&&(i=!0)}return i&&(e=0),[e,t,v]},this.onProgress=function(e){return function(t){b.progressMap[e]=[t.loaded,t.total]}},this.onError=function(e){v=!0},this.onWindowResize=function(){m.onResize(),b.camera.aspect=c.clientWidth/c.clientHeight,b.camera.updateProjectionMatrix()},this.resetView=function(){b.onWindowResize(),m.resetView()};b.camera=new n.PerspectiveCamera(40,c.clientWidth/c.clientHeight,0,10),b.ambient=new n.AmbientLight(2105376),h.add(b.ambient),b.directionalLight=new n.DirectionalLight(7829367),h.add(b.directionalLight),(m=new(r(10).CameraControls)(b.camera,t.domElement,t,h)).setDirectionalLight(b.directionalLight),m.resetView();var x=function(){for(var e=!0;1==e;){f++,e=!1;for(var t=0;t<l.length;t++)l[t].modelId==f&&(e=!0)}return f};this.loadView=function(e){var t=new(r(10).Viewport);t.nearPlane=e.nearPlane,t.farPlane=e.farPlane,t.eyePosition=e.eyePosition,t.targetPosition=e.targetPosition,t.upVector=e.upVector,m.setDefaultCameraSettings(t),m.resetView()},this.getBoundingBox=function(){for(var e=void 0,t=void 0,i=0;i<l.length;i++)t=l[i].getBoundingBox(),void 0==e?e=t:e.union(t);for(i=0;i<u.length;i++)t=u[i].getBoundingBox(),void 0==e?e=t:e.union(t);return e},this.viewAllWithBoundingBox=function(e){if(e){var t=e.min.distanceTo(e.max)/2,i=(e.min.x+e.max.x)/2,r=(e.min.y+e.max.y)/2,n=(e.min.z+e.max.z)/2,o=m.getViewportFromCentreAndRadius(i,r,n,t,40,4*t);m.setCurrentCameraSettings(o)}},this.viewAll=function(){var e=b.getBoundingBox();b.viewAllWithBoundingBox(e)},this.forEachGeometry=function(e){for(var t=0;t<l.length;t++)e(l[t])},this.forEachGlyphset=function(e){for(var t=0;t<u.length;t++)e(u[t])},this.findGeometriesWithGroupName=function(e){for(var t=[],i=0;i<l.length;i++)l[i].groupName==e&&t.push(l[i]);return t},this.findGlyphsetsWithGroupName=function(e){for(var t=[],i=0;i<u.length;i++)u[i].groupName==e&&t.push(u[i]);return t};var O=function(e,t,i,n){return function(){4==e.readyState&&200==e.status&&function(e,t,i,n){var o=new(r(4).Glyphset);o.duration=3e3,o.load(e,t,n),o.groupName=i;var a=o.getGroup();h.add(a),u.push(o)}(JSON.parse(e.responseText),t,i,n)}};this.loadGlyphsetURL=function(e,t,i,r){var n=new XMLHttpRequest;n.onreadystatechange=O(n,t,i,r),n.open("GET",e,!0),n.send()};var w=function(e,t){e&&("Surfaces"==e.Type?function(e,t,n,c,l,u){p+=1;var h=x(),d=r(0).defaultMaterialColor,m=r(0).defaultOpacity,f=0;void 0!=t&&(f=!!t);var v=0;void 0!=n&&(v=!!n);var g=new o(!0);if(void 0!==l)if("STL"==l)g=new a;else if("OBJ"==l)return void(g=new s).load(e,C(h,d,m,f,v,c,u),b.onProgress(i),b.onError);g.load(e,j(h,d,m,f,v,c,u),b.onProgress(i),b.onError)}(e.URL,e.MorphVertices,e.MorphColours,e.GroupName,e.FileFormat,t):"Glyph"==e.Type&&b.loadGlyphsetURL(e.URL,e.GlyphGeometriesURL,e.GroupName,t))};this.loadSTL=function(e,t,i){p+=1;var r=x(),n=Zinc.defaultMaterialColor,o=Zinc.defaultOpacity;(new a).load(e,j(r,n,o,!1,!1,t,i))},this.loadOBJ=function(e,t,i){p+=1;var r=x(),n=Zinc.defaultMaterialColor,o=Zinc.defaultOpacity;(new s).load(e,j(r,n,o,!1,!1,t,i))},this.loadMetadataURL=function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText),n=e.length;for(i=0;i<n;i++)w(e[i],t)}},requestURL=e,r.open("GET",e,!0),r.send()},this.loadModelsURL=function(e,t,i,r,n,a){var s=e.length;p+=s;for(var c=0;c<s;c++){var l=x(),u=e[c],h=new o(!0),d=Zinc.defaultMaterialColor,m=Zinc.defaultOpacity;void 0!=t&&void 0!=t[c]&&(d=!!t[c]),void 0!=i&&void 0!=i[c]&&(m=i[c]);var f=0;void 0!=r&&void 0!=r[c]&&(f=!!r[c]);var v=0;void 0!=n&&void 0!=n[c]&&(v=!!n[c]),h.load(u,j(l,d,m,f,v,void 0,a),b.onProgress(c),b.onError)}},this.loadViewURL=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText);b.loadView(e)}},requestURL=e,t.open("GET",requestURL,!0),t.send()},this.loadFromViewURL=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var r=JSON.parse(i.responseText);b.loadView(r);for(var n=[],o=e+"_",a=0;a<r.numberOfResources;a++){var s=o+(a+1)+".json";n.push(s)}b.loadModelsURL(n,r.colour,r.opacity,r.timeEnabled,r.morphColour,t)}},requestURL=e+"_view.json",i.open("GET",requestURL,!0),i.send()};var _=function(e,t,i,o){var a=new(r(1).Geometry);h.add(e);var s=new n.AnimationMixer(e),c=void 0,u=e.geometry;if(u.morphTargets){var m=n.AnimationClip.CreateClipsFromMorphTargetSequences(u.morphTargets,10,!0);if(m&&void 0!=m[0])(c=s.clipAction(m[0]).setDuration(d)).loop=n.loopOnce,c.clampWhenFinished=!0,c.play()}return a.duration=3e3,a.geometry=u,a.timeEnabled=i,a.morphColour=o,a.modelId=t,a.morph=e,a.mixer=s,a.clipAction=c,l.push(a),a},C=function(e,t,i,r,o,a,s){return function(t){p++,t.traverse(function(t){if(t instanceof n.Mesh){var i=_(t,e,r,o);i.morph&&(i.morph.name=a),i.groupName=a,void 0!=s&&"function"==typeof s&&s(i)}})}};this.addZincGeometry=function(e,t,i,r,o,a,s,c,l){void 0==s&&(s=!0),s&&p++,isTransparent=!1,1>r&&(isTransparent=!0);var u=void 0;l?(u=l).morphTargets=o:u=e instanceof n.BufferGeometry&&void 0===e.attributes.color?new n.MeshPhongMaterial({color:i,morphTargets:o,morphNormals:!1,transparent:isTransparent,opacity:r}):new n.MeshPhongMaterial({color:i,morphTargets:o,morphNormals:!1,vertexColors:n.VertexColors,transparent:isTransparent,opacity:r}),e instanceof n.Geometry&&e.computeMorphNormals(),u.side=n.DoubleSide;var h;h=new n.Mesh(e,u);var d=_(h,t,o,a);return void 0!=c&&"function"==typeof c&&c(d),d};var j=function(e,t,i,r,n,o,a){return function(s,c){var l=void 0;c&&c[0]&&(l=c[0]);var u=b.addZincGeometry(s,e,t,i,r,n,!1,void 0,l);u.morph&&(u.morph.name=o),u.groupName=o,void 0!=a&&"function"==typeof a&&a(u)}};this.updateDirectionalLight=function(){m.updateDirectionalLight()},this.addObject=function(e){h.add(e)},this.getCurrentTime=function(){var e=0;if(void 0!=l[0]){l[0].mixer;e=l[0].getCurrentTime()}return e},this.setMorphsTime=function(e){for(var t=0;t<l.length;t++)zincGeometry=l[t],zincGeometry.setMorphTime(e);for(t=0;t<u.length;t++)zincGlyphset=u[t],zincGlyphset.setMorphTime(e)},this.getZincGeometryByID=function(e){for(var t=0;t<l.length;t++)if(l[t].modelId==e)return l[t];return null};this.renderGeometries=function(e,t,i){if(m.update(t),l.length==p&&function(){for(var e=0;e<u.length;e++)if(zincGlyphset=u[e],0==zincGlyphset.ready)return!1;return!0}()){for(var r=0;r<l.length;r++)l[r].render(e*t,i);for(r=0;r<u.length;r++)u[r].render(e*t,i)}},this.getThreeJSScene=function(){return h},this.setAdditionalScenesGroup=function(e){h.add(e)},this.render=function(e){b.autoClearFlag&&e.clear(),g&&y?y.render(h,b.camera):e.render(h,b.camera)},this.setInteractiveControlEnable=function(e){1==e?m.enable():m.disable()},this.getZincCameraControls=function(){return m},this.getThreeJSScene=function(){return h},this.setDuration=function(e){d=e},this.getDuration=function(){return d},this.setStereoEffectEnable=function(e){1==e?(y||(y=new n.StereoEffect(t)),y.setSize(c.clientWidth,c.clientHeight)):t.setSize(c.clientWidth,c.clientHeight),b.camera.updateProjectionMatrix(),g=e},this.isStereoEffectEnable=function(){return g},this.removeZincGeometry=function(e){for(var t=0;t<l.length;t++)if(e===l[t])return h.remove(e.morph),l.splice(t,1),void e.dispose()},this.removeZincGlyphset=function(e){for(var t=0;t<u.length;t++)if(e===u[t])return h.remove(e.getGroup()),u[t].dispose(),void u.splice(t,1)},this.clearAll=function(){for(var e=l.length-1;e>=0;e--)h.remove(l[e].morph),l[e].dispose();l=[];for(e=u.length-1;e>=0;e--)h.remove(u[e].getGroup()),u[e].dispose();u=[]}}},function(e,t,i){"use strict";i.r(t),i.d(t,"STLLoader",function(){return n});var r=i(2);function n(e){this.manager=void 0!==e?e:r.DefaultLoadingManager}n.prototype={constructor:n,load:function(e,t,i,n){var o=this,a=new r.FileLoader(o.manager);a.setResponseType("arraybuffer"),a.load(e,function(e){try{t(o.parse(e))}catch(e){n&&n(e)}},i,n)},parse:function(e){var t,i=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}(e);return function(e){var t;if(84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var i=[115,111,108,105,100],r=0;r<5;r++)if(i[r]!=t.getUint8(r,!1))return!0;return!1}(i)?function(e){for(var t,i,n,o,a,s,c,l,u=new DataView(e),h=u.getUint32(80,!0),d=!1,m=0;m<70;m++)1129270351==u.getUint32(m,!1)&&82==u.getUint8(m+4)&&61==u.getUint8(m+5)&&(d=!0,o=[],a=u.getUint8(m+6)/255,s=u.getUint8(m+7)/255,c=u.getUint8(m+8)/255,l=u.getUint8(m+9)/255);for(var p=new r.BufferGeometry,f=[],v=[],g=0;g<h;g++){var y=84+50*g,b=u.getFloat32(y,!0),x=u.getFloat32(y+4,!0),O=u.getFloat32(y+8,!0);if(d){var w=u.getUint16(y+48,!0);0==(32768&w)?(t=(31&w)/31,i=(w>>5&31)/31,n=(w>>10&31)/31):(t=a,i=s,n=c)}for(var _=1;_<=3;_++){var C=y+12*_;f.push(u.getFloat32(C,!0)),f.push(u.getFloat32(C+4,!0)),f.push(u.getFloat32(C+8,!0)),v.push(b,x,O),d&&o.push(t,i,n)}}return p.addAttribute("position",new r.BufferAttribute(new Float32Array(f),3)),p.addAttribute("normal",new r.BufferAttribute(new Float32Array(v),3)),d&&(p.addAttribute("color",new r.BufferAttribute(new Float32Array(o),3)),p.hasColors=!0,p.alpha=l),p}(i):function(e){for(var t,i=new r.BufferGeometry,n=/facet([\s\S]*?)endfacet/g,o=0,a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+a+a+a,"g"),c=new RegExp("normal"+a+a+a,"g"),l=[],u=[],h=new r.Vector3;null!==(t=n.exec(e));){for(var d=0,m=0,p=t[0];null!==(t=c.exec(p));)h.x=parseFloat(t[1]),h.y=parseFloat(t[2]),h.z=parseFloat(t[3]),m++;for(;null!==(t=s.exec(p));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(h.x,h.y,h.z),d++;1!==m&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+o),3!==d&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+o),o++}return i.addAttribute("position",new r.Float32BufferAttribute(l,3)),i.addAttribute("normal",new r.Float32BufferAttribute(u,3)),i}("string"!=typeof(t=e)?r.LoaderUtils.decodeText(new Uint8Array(t)):t)}}},function(e,t,i){"use strict";i.r(t),i.d(t,"OBJLoader",function(){return n});var r=i(2),n=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function n(e){this.manager=void 0!==e?e:r.DefaultLoadingManager,this.materials=null}return n.prototype={constructor:n,load:function(e,t,i,n){var o=this,a=new r.FileLoader(o.manager);a.setPath(this.path),a.load(e,function(e){t(o.parse(e))},i,n)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(n){console.time("OBJLoader");var o=new function(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,o,a,s,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),d=this.parseVertexIndex(i,l);if(this.addVertex(u,h,d),void 0!==r&&""!==r){var m=this.uvs.length;u=this.parseUVIndex(r,m),h=this.parseUVIndex(n,m),d=this.parseUVIndex(o,m),this.addUV(u,h,d)}if(void 0!==a&&""!==a){var p=this.normals.length;u=this.parseNormalIndex(a,p),h=a===s?u:this.parseNormalIndex(s,p),d=a===c?u:this.parseNormalIndex(c,p),this.addNormal(u,h,d)}this.colors.length>0&&this.addColor(u,h,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e};-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var a=n.split("\n"),s="",c="",l=[],u="function"==typeof"".trimLeft,h=0,d=a.length;h<d;h++)if(s=a[h],0!==(s=u?s.trimLeft():s.trim()).length&&"#"!==(c=s.charAt(0)))if("v"===c){var m=s.split(/\s+/);switch(m[0]){case"v":o.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),8===m.length&&o.colors.push(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6]));break;case"vn":o.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vt":o.uvs.push(parseFloat(m[1]),parseFloat(m[2]))}}else if("f"===c){for(var p=s.substr(1).trim().split(/\s+/),f=[],v=0,g=p.length;v<g;v++){var y=p[v];if(y.length>0){var b=y.split("/");f.push(b)}}var x=f[0];for(v=1,g=f.length-1;v<g;v++){var O=f[v],w=f[v+1];o.addFace(x[0],O[0],w[0],x[1],O[1],w[1],x[2],O[2],w[2])}}else if("l"===c){var _=s.substring(1).trim().split(" "),C=[],j=[];if(-1===s.indexOf("/"))C=_;else for(var E=0,L=_.length;E<L;E++){var M=_[E].split("/");""!==M[0]&&C.push(M[0]),""!==M[1]&&j.push(M[1])}o.addLineGeometry(C,j)}else if("p"===c){var S=s.substr(1).trim().split(" ");o.addPointGeometry(S)}else if(null!==(l=e.exec(s))){var T=(" "+l[0].substr(1).trim()).substr(1);o.startObject(T)}else if(i.test(s))o.object.startMaterial(s.substring(7).trim(),o.materialLibraries);else if(t.test(s))o.materialLibraries.push(s.substring(7).trim());else{if("s"!==c){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((l=s.split(" ")).length>1){var R=l[1].trim().toLowerCase();o.object.smooth="0"!==R&&"off"!==R}else o.object.smooth=!0;(H=o.object.currentMaterial())&&(H.smooth=o.object.smooth)}o.finalize();var P=new r.Group;P.materialLibraries=[].concat(o.materialLibraries);for(h=0,d=o.objects.length;h<d;h++){var A=o.objects[h],V=A.geometry,z=A.materials,U="Line"===V.type,B="Points"===V.type,G=!1;if(0!==V.vertices.length){var N=new r.BufferGeometry;N.addAttribute("position",new r.Float32BufferAttribute(V.vertices,3)),V.normals.length>0?N.addAttribute("normal",new r.Float32BufferAttribute(V.normals,3)):N.computeVertexNormals(),V.colors.length>0&&(G=!0,N.addAttribute("color",new r.Float32BufferAttribute(V.colors,3))),V.uvs.length>0&&N.addAttribute("uv",new r.Float32BufferAttribute(V.uvs,2));for(var D,F=[],I=0,Z=z.length;I<Z;I++){var W=z[I],H=void 0;if(null!==this.materials)if(H=this.materials.create(W.name),!U||!H||H instanceof r.LineBasicMaterial){if(B&&H&&!(H instanceof r.PointsMaterial)){var k=new r.PointsMaterial({size:10,sizeAttenuation:!1});X.copy(H),H=k}}else{var X=new r.LineBasicMaterial;X.copy(H),X.lights=!1,H=X}H||((H=U?new r.LineBasicMaterial:B?new r.PointsMaterial({size:1,sizeAttenuation:!1}):new r.MeshPhongMaterial).name=W.name),H.flatShading=!W.smooth,H.vertexColors=G?r.VertexColors:r.NoColors,F.push(H)}if(F.length>1){for(I=0,Z=z.length;I<Z;I++){W=z[I];N.addGroup(W.groupStart,W.groupCount,I)}D=U?new r.LineSegments(N,F):B?new r.Points(N,F):new r.Mesh(N,F)}else D=U?new r.LineSegments(N,F[0]):B?new r.Points(N,F[0]):new r.Mesh(N,F[0]);D.name=A.name,P.add(D)}}return console.timeEnd("OBJLoader"),P}},n}()},function(e,t,i){var r,n,o,a,s,c,l,u,h=i(2),d=function(){this.nearPlane=.1,this.farPlane=2e3,this.eyePosition=[0,0,0],this.targetPosition=[0,0,0],this.upVector=[0,1,0]},m=function(e,t,i,r){var n=e.eyePosition,o=e.targetPosition,a=t.eyePosition,s=t.targetPosition,c=i,l=this,u=r,h=0,d=!1;c.near=Math.min(e.nearPlane,t.nearPlane),c.far=Math.max(e.farPlane,t.farPlane);this.update=function(e){var t,i,r;!1!==l.enabled&&(!function(e){var t=h+e;t>u&&(t=u),h=t}(e),t=h/u,i=[n[0]*(1-t)+a[0]*t,n[1]*(1-t)+a[1]*t,n[2]*(1-t)+a[2]*t],r=[o[0]*(1-t)+s[0]*t,o[1]*(1-t)+s[1]*t,o[2]*(1-t)+s[2]*t],c.cameraObject.position.set(i[0],i[1],i[2]),c.cameraObject.target.set(r[0],r[1],r[2]),h==u&&(d=!0))},this.isTransitionCompleted=function(){return d}},p=function(e,t,i,r){var n=e,o=r,a=t,s=i,c=new h.Raycaster,l=new h.Vector2;this.enable=function(){enable=!0},this.disable=function(){enable=!1};var u=function(e,t,i){var r=e.domElement.getBoundingClientRect();l.x=(t-r.left)/r.width*2-1,l.y=-(i-r.top)/r.height*2+1;var a=n.getThreeJSScene();return o.render(a,e.cameraObject),c.setFromCamera(l,e.cameraObject),c.intersectObjects(a.children,!0)};this.pick=function(e,t,i){if(o&&n&&e&&a){var r=u(e,t,i);a(r,t,i)}},this.move=function(e,t,i){if(o&&n&&e&&s){var r=u(e,t,i);s(r,t,i)}}},f=function(e,t,i,r){var n=new h.Vector3,o=-t,a=r,s=this,c=e;this.stopOnCameraInput=i,this.requireUpdate=!0;this.update=function(e){!1!==s.enabled&&(s.requireUpdate&&(!function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),i=.25*(4*Math.abs(e[0])+4*Math.abs(e[1])),r=-e[1]/t,o=e[0]/t,s=r*e[0]+o*-e[1];s>i?s=i:s<-i&&(s=-i);var c=Math.acos(s/i)-.5*Math.PI,l=new h.Vector3(a.cameraObject.position.x-a.cameraObject.target.x,a.cameraObject.position.y-a.cameraObject.target.y,a.cameraObject.position.z-a.cameraObject.target.z);l.normalize();var u=new h.Vector3(a.cameraObject.up.x,a.cameraObject.up.y,a.cameraObject.up.z);u.normalize();var d=new h.Vector3;d.crossVectors(u,l),d.normalize();var m=new h.Vector3(r*d.x+o*u.x,r*d.y+o*u.y,r*d.z+o*u.z);n.x=Math.sin(c)*l.x+Math.cos(c)*m.x,n.y=Math.sin(c)*l.y+Math.cos(c)*m.y,n.z=Math.sin(c)*l.z+Math.cos(c)*m.z}(c),s.requireUpdate=!1),a.rotateAboutLookAtpoint(n,o))}};StereoCameraZoomFixed=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new h.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new h.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},Object.assign(StereoCameraZoomFixed.prototype,{update:(l=new h.Matrix4,u=new h.Matrix4,function(e){if(r!==e.focus||n!==e.fov||o!==e.aspect*this.aspect||a!==e.near||s!==e.far||c!==e.zoom){r=e.focus,n=e.fov,o=e.aspect*this.aspect,a=e.near,s=e.far,c=e.zoom;var t,i,d=e.projectionMatrix.clone(),m=.032*a/r,p=a*Math.tan(h.Math.DEG2RAD*n*.5)/e.zoom;u.elements[12]=-.032,l.elements[12]=.032,t=-p*o+m,i=p*o+m,d.elements[0]=2*a/(i-t),d.elements[8]=(i+t)/(i-t),this.cameraL.projectionMatrix.copy(d),t=-p*o-m,i=p*o-m,d.elements[0]=2*a/(i-t),d.elements[8]=(i+t)/(i-t),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(l)})});ModifiedDeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0;var i,r,n,o,a=function(e){t.deviceOrientation=e},s=function(){"undefined"!=typeof window&&(t.screenOrientation=window.orientation||0)},c=(i=new h.Vector3(0,0,1),r=new h.Euler,n=new h.Quaternion,o=new h.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,c){var l=new h.Vector3(0,0,1);l.subVectors(e.target,e.position),r.set(a,t,-s,"YXZ");var u=new h.Quaternion;u.setFromEuler(r),u.multiply(o),u.multiply(n.setFromAxisAngle(i,-c)),l.applyQuaternion(u),l.addVectors(e.position,l),e.lookAt(l)});this.connect=function(){s(),"undefined"!=typeof window&&(window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1)),t.enabled=!0},this.disconnect=function(){"undefined"!=typeof window&&(window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1)),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation.alpha?h.Math.degToRad(t.deviceOrientation.alpha):0,i=t.deviceOrientation.beta?h.Math.degToRad(t.deviceOrientation.beta):0,r=t.deviceOrientation.gamma?h.Math.degToRad(t.deviceOrientation.gamma):0,n=t.screenOrientation?h.Math.degToRad(t.screenOrientation):0;c(t.object,e,i,r,n)}},this.dispose=function(){this.disconnect()},this.connect()},t.Viewport=d,t.CameraControls=function(e,t,i,r){var n=this,o=0,a=1,s=2,c=3,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5,SCROLL:6},u={};u.MAIN=l.ROTATE,u.AUXILIARY=l.PAN,u.SECONDARY=l.ZOOM,this.cameraObject=e,this.domElement=void 0!==t?t:document,this.renderer=i,this.scene=r,this.tumble_rate=1.5,this.pointer_x=0,this.pointer_y=0,this.pointer_x_start=0,this.pointer_y_start=0,this.previous_pointer_x=0,this.previous_pointer_y=0,this.near_plane_fly_debt=0,this.touchZoomDistanceStart=0,this.touchZoomDistanceEnd=0,this.directionalLight=0,this.scrollRate=50;var v=3e3,g=0,y=void 0,b=void 0,x=!1,O=500,w=void 0,_=new d,C=o,j=void 0,E=void 0,L=0;this._state=l.NONE;var M=void 0;this.targetTouchId=-1;var S=void 0;function T(e){void 0===S&&(S=n.domElement.getBoundingClientRect()),0==e.button?n._state=u.MAIN:1==e.button?(e.preventDefault(),n._state=u.AUXILIARY):2==e.button&&(n._state=u.SECONDARY),n.pointer_x=e.clientX-S.left,n.pointer_y=e.clientY-S.top,n.pointer_x_start=n.pointer_x,n.pointer_y_start=n.pointer_y,n.previous_pointer_x=n.pointer_x,n.previous_pointer_y=n.pointer_y}function R(e){void 0===S&&(S=n.domElement.getBoundingClientRect()),n.pointer_x=e.clientX-S.left,n.pointer_y=e.clientY-S.top,void 0!==M&&M.move(n,e.clientX,e.clientY,n.renderer)}function P(e){n._state=l.NONE,void 0!==M&&n.pointer_x_start==e.clientX-S.left&&n.pointer_y_start==e.clientY-S.top&&M.pick(n,e.clientX,e.clientY,n.renderer)}function A(e){n._state=l.NONE}function V(e){void 0===S&&(S=n.domElement.getBoundingClientRect());var t=e.touches.length;if(1==t)n._state=l.TOUCH_ROTATE,n.pointer_x=e.touches[0].clientX-S.left,n.pointer_y=e.touches[0].clientY-S.top,n.pointer_x_start=n.pointer_x,n.pointer_y_start=n.pointer_y,n.previous_pointer_x=n.pointer_x,n.previous_pointer_y=n.pointer_y;else if(2==t){n._state=l.TOUCH_ZOOM;var i=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY;n.touchZoomDistanceEnd=n.touchZoomDistanceStart=Math.sqrt(i*i+r*r)}else 3==t&&(n._state=l.TOUCH_PAN,n.targetTouchId=e.touches[0].identifier,n.pointer_x=e.touches[0].clientX-S.left,n.pointer_y=e.touches[0].clientY-S.top,n.previous_pointer_x=n.pointer_x,n.previous_pointer_y=n.pointer_y)}function z(e){e.preventDefault(),e.stopPropagation();var t=e.touches.length;if(1==t)n.pointer_x=e.touches[0].clientX-S.left,n.pointer_y=e.touches[0].clientY-S.top;else if(2==t){if(n._state===l.TOUCH_ZOOM){var i=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY;n.touchZoomDistanceEnd=Math.sqrt(i*i+r*r)}}else if(3==t&&n._state===l.TOUCH_PAN)for(var o=0;o<3;o++)e.touches[o].identifier==n.targetTouchId&&(n.pointer_x=e.touches[0].clientX-S.left,n.pointer_y=e.touches[0].clientY-S.top)}function U(e){var t=e.touches.length;n.touchZoomDistanceStart=n.touchZoomDistanceEnd=0,n.targetTouchId=-1,n._state=l.NONE,1==t&&void 0!==M&&n.pointer_x_start==e.touches[0].clientX-S.left&&n.pointer_y_start==e.touches[0].clientY-S.top&&M.pick(n.cameraObject,e.touches[0].clientX,e.touches[0].clientY,n.renderer)}function B(e){void 0===S&&(S=n.domElement.getBoundingClientRect()),n._state=l.SCROLL;var t=0;e.deltaY>0?t=n.scrollRate:e.deltaY<0&&(t=-1*n.scrollRate),L+=t,e.preventDefault(),e.stopImmediatePropagation()}function G(){if(void 0!==n.cameraObject){S.width;var e=S.height,t=n.cameraObject.position.clone();t.sub(n.cameraObject.target);var i=(c=0,n._state===l.ZOOM?c=n.previous_pointer_y-n.pointer_y:n._state===l.SCROLL?c=L:(c=-1*(n.touchZoomDistanceEnd-n.touchZoomDistanceStart),n.touchZoomDistanceStart=n.touchZoomDistanceEnd),c),r=t.length(),o=1.5*i/e;if(r+o*r>.01){t.normalize();var a=n.cameraObject.position.clone();if(a.x=a.x+t.x*o*r,a.y=a.y+t.y*o*r,a.z=a.z+t.z*o*r,n.cameraObject.position.set(a.x,a.y,a.z),n.updateDirectionalLight(),1e-5*n.cameraObject.far<n.cameraObject.near+o*r+n.near_plane_fly_debt)0!=n.near_plane_fly_debt&&(n.near_plane_fly_debt+=o*r,n.near_plane_fly_debt>0?(n.cameraObject.near+=n.near_plane_fly_debt,n.cameraObject.far+=n.near_plane_fly_debt,n.near_plane_fly_debt=0):(n.cameraObject.near+=o*r,n.cameraObject.far+=o*r));else{if(0==n.near_plane_fly_debt){var s=n.cameraObject.near-1e-5*n.cameraObject.far;n.cameraObject.near=1e-5*n.cameraObject.far,n.cameraObject.far-=s,n.near_plane_fly_debt-=1e-5*n.cameraObject.far}n.near_plane_fly_debt+=o*r}}}var c;n._state===l.ZOOM&&(n.previous_pointer_x=n.pointer_x,n.previous_pointer_y=n.pointer_y),n._state===l.SCROLL&&(L=0)}void 0===n.cameraObject.target&&(n.cameraObject.target=new h.Vector3(0,0,0)),this.onResize=function(){S&&(S=void 0)},this.setMouseButtonAction=function(e,t){u[e]=l[t]},this.rotateAboutLookAtpoint=function(e,t){e.normalize();var i=n.cameraObject.position.clone();i.sub(n.cameraObject.target);var r=i.clone();i.normalize(),.8<Math.abs(i.x*e.x+i.y*e.y+i.z*e.z)&&(i=n.cameraObject.up.clone());var o=new h.Vector3(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x);o.normalize();var a=new h.Vector3(e.y*o.z-e.z*o.y,e.z*o.x-e.x*o.z,e.x*o.y-e.y*o.x),s=e.x*r.x+e.y*r.y+e.z*r.z,c=o.x*r.x+o.y*r.y+o.z*r.z,l=a.x*r.x+a.y*r.y+a.z*r.z,u=e.x*n.cameraObject.up.x+e.y*n.cameraObject.up.y+e.z*n.cameraObject.up.z,d=o.x*n.cameraObject.up.x+o.y*n.cameraObject.up.y+o.z*n.cameraObject.up.z,m=a.x*n.cameraObject.up.x+a.y*n.cameraObject.up.y+a.z*n.cameraObject.up.z,p=Math.cos(t),f=Math.sin(t),v=new h.Vector3(p*o.x+f*a.x,p*o.y+f*a.y,p*o.z+f*a.z),g=new h.Vector3(p*a.x-f*o.x,p*a.y-f*o.y,p*a.z-f*o.z),y=n.cameraObject.target.clone();y.x=y.x+e.x*s+v.x*c+g.x*l,y.y=y.y+e.y*s+v.y*c+g.y*l,y.z=y.z+e.z*s+v.z*c+g.z*l,n.cameraObject.position.set(y.x,y.y,y.z),n.updateDirectionalLight(),n.cameraObject.up.set(e.x*u+v.x*d+g.x*m,e.y*u+v.y*d+g.y*m,e.z*u+v.z*d+g.z*m)},this.setDirectionalLight=function(e){n.directionalLight=e},this.updateDirectionalLight=function(){0!=n.directionalLight&&n.directionalLight.position.set(n.cameraObject.position.x,n.cameraObject.position.y,n.cameraObject.position.z)},this.enable=function(){enabled=!0,this.domElement.addEventListener&&(this.domElement.addEventListener("mousedown",T,!1),this.domElement.addEventListener("mousemove",R,!1),this.domElement.addEventListener("mouseup",P,!1),this.domElement.addEventListener("mouseleave",A,!1),this.domElement.addEventListener("touchstart",V,!1),this.domElement.addEventListener("touchmove",z,!1),this.domElement.addEventListener("touchend",U,!1),this.domElement.addEventListener("wheel",B,!1),this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1))},this.disable=function(){enabled=!1,this.domElement.removeEventListener&&(this.domElement.removeEventListener("mousedown",T,!1),this.domElement.removeEventListener("mousemove",R,!1),this.domElement.removeEventListener("mouseup",P,!1),this.domElement.removeEventListener("mouseleave",A,!1),this.domElement.removeEventListener("touchstart",V,!1),this.domElement.removeEventListener("touchmove",z,!1),this.domElement.removeEventListener("touchend",U,!1),this.domElement.removeEventListener("wheel",B,!1),this.domElement.removeEventListener("contextmenu",function(e){e.preventDefault()},!1))};this.loadPathURL=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&function(e){y=e.CameraPath,b=e.NumberOfPoints}(JSON.parse(i.responseText))},requestURL=e,i.open("GET",requestURL,!0),i.send()},this.setPathDuration=function(e){v=e},this.setTime=function(e){g=e},this.setPlayRate=function(e){O=e};this.getNumberOfTimeFrame=function(){return b},this.getCurrentTimeFrame=function(){var e=g/v*(b-1),t=Math.floor(e),i=1-(e-t);return[t,Math.ceil(e),i]},this.setCurrentTimeFrame=function(e){(g=v*e/(b-1))<0&&(g=0),g>v&&(g=v)};var N=function(e){if(C===a&&(function(e){var t=g+e;t>v&&(t-=v),g=t}(e),y)){for(var t=n.getCurrentTimeFrame(),i=t[0],r=t[1],o=t[2],s=[y[3*i],y[3*i+1],y[3*i+2]],c=[y[3*r],y[3*r+1],y[3*r+2]],l=[],u=0;u<s.length;u++)l.push(o*s[u]+(1-o)*c[u]);n.cameraObject.position.set(l[0],l[1],l[2]),n.cameraObject.target.set(c[0],c[1],c[2]),x&&(n.directionalLight.position.set(l[0],l[1],l[2]),n.directionalLight.target.position.set(c[0],c[1],c[2]))}};this.update=function(e){var t=e*O,i=enabled;C===a?N(t):C===s&&j?(j.update(t),j.isTransitionCompleted()&&(C=o),i=!1):C===c&&E&&E.update(t),i&&(n._state===l.ROTATE||n._state===l.TOUCH_ROTATE?function(){if(void 0!==n.cameraObject){var e=S.width,t=S.height;if(0<e&&0<t){var i=.25*(e+t);delta_x=n.pointer_x-n.previous_pointer_x,delta_y=n.previous_pointer_y-n.pointer_y;var r=Math.sqrt(delta_x*delta_x+delta_y*delta_y);if(r>0){var o=1*-delta_y/r,a=1*delta_x/r,s=o*(n.pointer_x-.5*(e-1))+a*(.5*(t-1)-n.pointer_y);s>i?s=i:s<-i&&(s=-i);var c=Math.acos(s/i)-.5*Math.PI,l=n.tumble_rate*r/i,u=n.cameraObject.position.clone();u.sub(n.cameraObject.target),u.normalize();var d=n.cameraObject.up.clone();d.normalize();var m=d.clone();m.cross(u),m.normalize();var p=[o*m.x+a*d.x,o*m.y+a*d.y,o*m.z+a*d.z],f=new h.Vector3;f.set(Math.sin(c)*u.x+Math.cos(c)*p[0],Math.sin(c)*u.y+Math.cos(c)*p[1],Math.sin(c)*u.z+Math.cos(c)*p[2]),n.rotateAboutLookAtpoint(f,-l)}}}n.previous_pointer_x=n.pointer_x,n.previous_pointer_y=n.pointer_y}():n._state===l.PAN||n._state===l.TOUCH_PAN?function(){if(void 0!==n.cameraObject){S.width;var e=S.height,t=n.cameraObject.position.distanceTo(n.cameraObject.target),i=0;n.cameraObject.far>n.cameraObject.near&&t>=n.cameraObject.near&&t<=n.cameraObject.far&&(i=(t-n.cameraObject.near)/(n.cameraObject.far-n.cameraObject.near));var r=new h.Vector3(n.previous_pointer_x,e-n.previous_pointer_y,0),o=new h.Vector3(n.previous_pointer_x,e-n.previous_pointer_y,1),a=new h.Vector3(n.pointer_x,e-n.pointer_y,0),s=new h.Vector3(n.pointer_x,e-n.pointer_y,1);r.unproject(n.cameraObject),o.unproject(n.cameraObject),a.unproject(n.cameraObject),s.unproject(n.cameraObject);var c=.002*((1-i)*(a.x-r.x)+i*(s.x-o.x)),l=.002*((1-i)*(a.y-r.y)+i*(s.y-o.y)),u=.002*((1-i)*(a.z-r.z)+i*(s.z-o.z));n.cameraObject.position.set(n.cameraObject.position.x-c,n.cameraObject.position.y-l,n.cameraObject.position.z-u),n.updateDirectionalLight(),n.cameraObject.target.set(n.cameraObject.target.x-c,n.cameraObject.target.y-l,n.cameraObject.target.z-u)}n.previous_pointer_x=n.pointer_x,n.previous_pointer_y=n.pointer_y}():n._state!==l.ZOOM&&n._state!==l.TOUCH_ZOOM&&n._state!==l.SCROLL||G(),n._state!==l.NONE&&C===c&&E&&E.stopOnCameraInput,n._state===l.SCROLL&&(n._state=l.NONE)),w?w.update():n.cameraObject.lookAt(n.cameraObject.target)},this.playPath=function(){C=a},this.stopPath=function(){C=o},this.isPlayingPath=function(){return C===a},this.enableDirectionalLightUpdateWithPath=function(e){x=e},this.enableDeviceOrientation=function(){w||(w=new ModifiedDeviceOrientationControls(n.cameraObject))},this.disableDeviceOrientation=function(){w&&(w.dispose(),w=void 0)},this.isDeviceOrientationEnabled=function(){return!!w},this.resetView=function(){n.cameraObject.near=_.nearPlane,n.cameraObject.far=_.farPlane,n.cameraObject.position.set(_.eyePosition[0],_.eyePosition[1],_.eyePosition[2]),n.cameraObject.target.set(_.targetPosition[0],_.targetPosition[1],_.targetPosition[2]),n.cameraObject.up.set(_.upVector[0],_.upVector[1],_.upVector[2]),n.cameraObject.updateProjectionMatrix(),n.updateDirectionalLight()},this.setDefaultCameraSettings=function(e){e.nearPlane&&(_.nearPlane=e.nearPlane),e.farPlane&&(_.farPlane=e.farPlane),e.eyePosition&&(_.eyePosition=e.eyePosition),e.targetPosition&&(_.targetPosition=e.targetPosition),e.upVector&&(_.upVector=e.upVector)},this.setCurrentCameraSettings=function(e){e.nearPlane&&(n.cameraObject.near=e.nearPlane),e.farPlane&&(n.cameraObject.far=e.farPlane),e.eyePosition&&n.cameraObject.position.set(e.eyePosition[0],e.eyePosition[1],e.eyePosition[2]),e.targetPosition&&n.cameraObject.target.set(e.targetPosition[0],e.targetPosition[1],e.targetPosition[2]),e.upVector&&n.cameraObject.up.set(e.upVector[0],e.upVector[1],e.upVector[2]),n.cameraObject.updateProjectionMatrix(),n.updateDirectionalLight()},this.getViewportFromCentreAndRadius=function(e,t,i,r,o,a){var s=n.cameraObject.position.x-n.cameraObject.target.x,c=n.cameraObject.position.y-n.cameraObject.target.y,l=n.cameraObject.position.z-n.cameraObject.target.z,u=1/Math.sqrt(s*s+c*c+l*l);s*=u,c*=u,l*=u;var h=[e,t,i],m=r/Math.tan(o*Math.PI/360),p=[e+s*m,t+c*m,i+l*m],f=m+a,v=0;v=a>.95*m?(1-.95)*m:m-a;var g=new d;return g.nearPlane=v,g.farPlane=f,g.eyePosition=p,g.targetPosition=h,g.upVector=[n.cameraObject.up.x,n.cameraObject.up.y,n.cameraObject.up.z],g},this.getDefaultViewport=function(){return _},this.getCurrentViewport=function(){var e=new d;return e.nearPlane=n.cameraObject.near,e.farPlane=n.cameraObject.far,e.eyePosition[0]=n.cameraObject.position.x,e.eyePosition[1]=n.cameraObject.position.y,e.eyePosition[2]=n.cameraObject.position.z,e.targetPosition[0]=n.cameraObject.target.x,e.targetPosition[1]=n.cameraObject.target.y,e.targetPosition[2]=n.cameraObject.target.z,e.upVector[0]=n.cameraObject.up.x,e.upVector[1]=n.cameraObject.up.y,e.upVector[2]=n.cameraObject.up.z,e},this.getDefaultEyePosition=function(){return eyePosition},this.getDefaultTargetPosition=function(){return targetPosition},this.cameraTransition=function(e,t,i){j=new m(e,t,n,i)},this.enableCameraTransition=function(){C=s},this.pauseCameraTransition=function(){C=o},this.stopCameraTransition=function(){C=o,j=void 0},this.isTransitioningCamera=function(){return C===s},this.autoTumble=function(e,t,i){E=new f(e,t,i,n)},this.enableAutoTumble=function(){C=c},this.stopAutoTumble=function(){C=o,E=void 0},this.enableRaycaster=function(e,t,i){void 0==M&&(M=new p(e,t,i,n.renderer))},this.disableRaycaster=function(){M.disable(),M=void 0},this.updateAutoTumble=function(){E&&(E.requireUpdate=!0)},this.isAutoTumble=function(){return C===c},this.enable()},t.SmoothCameraTransition=m,t.RayCaster=p,t.CameraAutoTumble=f,t.StereoEffect=function(e){var t=new StereoCameraZoom;t.aspect=.5,this.setSize=function(t,i){e.setSize(t,i)},this.render=function(i,r){i.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),t.update(r);var n=e.getSize();e.setScissorTest(!0),e.clear(),e.setScissor(0,0,n.width/2,n.height),e.setViewport(0,0,n.width/2,n.height),e.render(i,t.cameraL),e.setScissor(n.width/2,0,n.width/2,n.height),e.setViewport(n.width/2,0,n.width/2,n.height),e.render(i,t.cameraR),e.setScissorTest(!1)}}},function(e,t){function i(e,t,i,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?i(n.responseText,t):r(e))},n.send(null)}t.loadExternalFile=i,t.loadExternalFiles=function(e,t,r){var n=e.length,o=0,a=[];function s(e,i){a[i]=e,++o==n&&t(a)}for(var c=0;c<n;c++)i(e[c],c,s,r)}}])});